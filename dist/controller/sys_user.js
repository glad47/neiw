/** layuiAdmin.pro-v1.0.0 LPPL License By http://www.layui.com/admin/ */
 ;"use strict";layui.define(["admin","table","index","element","form"],function(e){var t,i=layui.jquery,n=layui.table,l=layui.view,r=layui.admin,s=layui.form,a=layui.setter;layui.element;s.render(null,"user_info_formlist"),s.on("submit(LAY-user-info-search)",function(e){var t=e.field;n.reload("user_infoTab",{where:t})}),i(".user-info-search-form input").bind("input propertychange",function(e){i("*[lay-filter='LAY-user-info-search']").click()}),s.on("select(search-dept-sel)",function(e){i("*[lay-filter='LAY-user-info-search']").click()}),n.render({elem:"#user_infoTab",url:a.baseUrl+"sys/user/list",cellMinWidth:80,id:"user_infoTab",toolbar:!0,page:!0,cols:[[{field:"userId",title:"用户ID",sort:!0,width:90,align:"center"},{field:"username",title:"用户名",width:180,align:"center"},{field:"mobile",title:"办公电话",minWidth:106,align:"center"},{field:"deptId",title:"部门id",sort:!0,width:150,align:"center",hide:!0},{field:"deptName",title:"部门",sort:!0,width:150,align:"center"},{field:"jobNumber",title:"工号",align:"center",sort:!0,width:120},{field:"skype",title:"Skype",sort:!0,width:120,align:"center"},{field:"email",title:"Email",sort:!0,align:"center"},{field:"status",title:"状态",sort:!0,align:"center",templet:"#user_status"},{field:"createUserId",title:"创建人",align:"center"},{field:"createTime",title:"创建时间",width:200,align:"center"},{title:"操作",width:115,align:"center",fixed:"right",toolbar:"#user_info_Toolbar"}]],done:function(){/(iPhone|iPad|iPod|iOS|Android)/i.test(navigator.userAgent)&&i("#LAY_app_body").each(function(e){i("a[lay-event='edit']").html('<i class="layui-icon layui-icon-edit"></i>'),i("a[lay-event='search']").html('<i class="layui-icon layui-icon-search"></i>'),i("a[lay-event='del']").html('<i class="layui-icon layui-icon-delete"></i>'),i(".laytable-cell-1-0-22").css({width:"130px"})})}}),n.on("tool(user_infoTab)",function(e){var i=e.data,o=i.userId,u=i.username,d=i.deptName;"edit"===e.event?(t="useredit",r.req({type:"get",url:a.baseUrl+"sys/user/info/"+o,success:function(e){var t=e.user;t.deptName=d,console.log(t),r.popup({title:"修改用户信息",shadeClose:!0,shade:!1,maxmin:!0,btn:["提交"]["取消"],id:"userAdd_form",area:["766px","510px"],success:function(e,i){l(this.id).render("/infoManagement/iframeWindow/user_edit_info",t).done(function(){var e;s.render(null,"user_editInfo_form"),s.on("switch(switchUser)",function(t){1==t.elem.checked?(layer.msg("已启用"),e=1):(layer.msg("停用"),e=0)}),s.on("submit(LAY-user-editInfo-submit)",function(t){var n=t.field;return n.userId=o,n.status=e,console.log("用户修改表单提交的信息为："+JSON.stringify(n)),r.req({type:"post",url:a.baseUrl+"sys/user/update",data:n,done:function(e){console.log(e),layer.msg("用户信息修改成功"),layui.table.reload("user_infoTab")},fail:function(e){layer.msg("用户信息修改失败，请稍后再试！")}}),layer.close(i),!1})})}})}})):"del"===e.event&&layer.confirm("确定删除用户名名为［"+u+"］吗？",function(t){r.req({type:"post",url:a.baseUrl+"sys/user/delete",data:{userIds:o},done:function(i){layer.msg("用户删除成功"),e.del(),layer.close(t),n.reload("supplier_infoTab")},fail:function(e){layer.msg("服务器异常，稍后再试！")}})})});var o={userInfo_add:function(e){t="useradd";var i;r.popup({title:"添加用户信息",shadeClose:!0,shade:!1,maxmin:!0,area:["766px","510px"],success:function(t,n){l(this.id).render("/infoManagement/iframeWindow/user_edit_info",e).done(function(){s.render(null,"user_editInfo_form"),s.on("switch(switchUser)",function(e){1==e.elem.checked?(layer.msg("已启用"),i=1):(layer.msg("停用"),i=0)}),s.on("submit(LAY-user-editInfo-submit)",function(e){var t=e.field;return""==t.status||null==t.status||"off"==t.status?t.status=0:"on"==t.status&&(t.status=1),console.log("新增用户提交的表单值为："+JSON.stringify(t)),r.req({type:"post",url:a.baseUrl+"sys/user/save",data:t,done:function(e){console.log(e),layer.msg("用户信息添加成功"),layui.table.reload("user_infoTab")},fail:function(e){layer.msg("用户信息添加失败，请稍后再试！")}}),layer.close(n),!1})})}})}};i("div").delegate(".layui-btn","click",function(){var e=i(this).data("type");o[e]&&o[e].call(this)}),s.verify({username:function(e,t){if(null==e||""==e)return"用户名不能为空！！！"},password:function(e,i){if("useredit"!=t)return null==e||""==e?"密码不能为空！！！":void 0},jobNumber:function(e,t){if(null==e||""==e)return"工号不能为空！！！"}}),r.req({type:"get",url:layui.setter.baseUrl+"sys/dept/list",success:function(e){for(var t="",n=e.data,l=0;l<n.length;l++)t+="<option value='"+n[l].deptName+"'>"+n[l].deptName+"</option>";i("select[name='deptName']").append(t),s.render()}}),e("sys_user",{})});