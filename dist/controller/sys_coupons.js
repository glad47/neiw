/** layuiAdmin.pro-v1.0.0 LPPL License By http://www.layui.com/admin/ */
 ;"use strict";layui.define(["table","form","r"],function(e){var t=layui.$,n=layui.table,o=layui.form,i=layui.setter,s=layui.r;o.render(null,"sys-coupons-list"),o.on("submit(LAY-sys-coupons-search)",function(e){var t=e.field;n.reload("LAY-sys-coupons-list",{where:t})}),n.render({elem:"#LAY-sys-coupons-list",url:i.baseUrl+"sys/coupons/list",parseData:function(e){return{code:0,data:e.page.list,count:e.page.totalCount}},cols:[[{type:"checkbox",fixed:"left"},{field:"id",width:100,title:"ID",sort:!0,align:"center"},{field:"couponCode",title:"优惠码",minWidth:100,align:"center"},{field:"couponMoney",title:"金额",align:"center"},{field:"startTime",title:"开始时间",align:"center"},{field:"endTime",title:"结束时间",align:"center"},{field:"userSystemId",title:"客户编号",align:"center"},{field:"couponStatus",title:"状态",templet:"#couponStatusTpl",minWidth:80,align:"center"},{title:"操作",minWidth:150,align:"center",fixed:"right",toolbar:"#table-content-list"}]],page:!0}),n.on("tool(LAY-sys-coupons-list)",function(e){"del"===e.event?window.del(e.data):"edit"===e.event&&window.edit(e)});var l={batchdel:function(){var e=n.checkStatus("LAY-app-content-list"),t=e.data;return 0===t.length?layer.msg("请选择数据"):void layer.confirm("确定删除吗？",function(e){n.reload("LAY-app-content-list"),layer.msg("已删除")})},add:function(){window.add({})},createCode:function(){window.couponGenerate({})}};window.del=function(e){layer.confirm("确定删除吗？",function(t){s.get("sys/coupons/delete",{ids:e.id}).then(function(){layer.msg("已删除"),n.reload("LAY-sys-coupons-list"),layer.close(t)})})},window.couponGenerate=function(e){s.get("sys/coupons/ruleList",null,!1).then(function(t){return e.ruleList=t,e.operateMark=2,s.popup("选择生成规则",["60%","65%"],["生成","取消"],"infoManagement/iframeWindow/sys_coupons_form",e,"sys-coupons-form-submit","sys-coupons-rule-list-table",2)}).then(function(e){return layer.close(e.index),s.get("sys/coupons/couponGenerate",{flag:e.tableData.codeFlag},!0)}).then(function(e){layer.alert(e,{icon:1,skin:"layer-ext-moon"})})},window.edit=function(e){s.get("sys/coupons/ruleList",null,!1).then(function(t){return e.ruleList=t,e.operateMark=1,s.popup("编辑优惠券",["60%","65%"],["修改","取消"],"infoManagement/iframeWindow/sys_coupons_form",e,"sys-coupons-form-submit","sys-coupons-rule-list-table",2)})},window.add=function(e){var t;s.get("sys/coupons/ruleList",null,!1).then(function(t){return e.ruleList=t,e.operateMark=1,s.popup("添加优惠券",["60%","65%"],["保存","取消"],"infoManagement/iframeWindow/sys_coupons_form",e,"sys-coupons-form-submit","sys-coupons-rule-list-table",2)}).then(function(e){var n=e.formData.field;return t=e.index,n.couponRule=e.tableData,s.post("sys/coupons/save",n)}).then(function(e){layer.msg("添加成功！！！"),n.reload("LAY-sys-coupons-list"),layer.close(t)})},t(".layui-btn.layuiadmin-btn-list").on("click",function(){var e=t(this).data("type");l[e]?l[e].call(this):""}),e("sys_coupons",{})});