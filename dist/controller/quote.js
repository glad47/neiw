/** layuiAdmin.pro-v1.0.0 LPPL License By http://www.layui.com/admin/ */
 ;"use strict";layui.define(["admin","form","element","laytpl","layer","upload","jsTools","formSelects"],function(e){function t(e){if(1===ve){r("1");var t=parseFloat(oe*re*se)/1e6;N("#areasq").val(t.toFixed(3))}else if(2===ve){r("2");var t=parseFloat(de*me*pe)/1e6;if(N("#areasq").val(t.toFixed(3)),""!=pe&&""!=ce&&""!=ue){var i=Math.ceil(pe*ce*ue);N("#quantityPCS").val(i)}}}function i(e){N("#areasq").val(""),0===e?(N(".itPanelway input").attr("disabled",L.isDis.itPanelway),N(".itPanelsize input").attr("disabled",L.isDis.itPanelsize)):1===e?(N(".mto-input").removeAttr("disabled","true"),N(".itPanelway input").attr("disabled","disabled"),N(".itPanelsize input").attr("disabled","disabled"),N(".itSinlgesize input").val(""),N(".itPanelway input").val(""),N(".itPanelsize input").val("")):2===e&&(N(".mto-input").removeAttr("disabled","true"),N(".itSinlgesize input").attr("disabled","disabled"),N(".itSinlgesize input").val(""))}function n(){N("#selHc").attr("disabled",le.isDis.selHc),N("#selInlayercoopper").attr("disabled",le.isDis.selInlayercoopper),N("#selInnerMintrack").attr("disabled",le.isDis.selInnerMintrack),N("#selNofcore").attr("disabled",le.isDis.selNofcore),N("#selMinspaccing").attr("disabled",le.isDis.selMinspaccing),N("#selNofpp").attr("disabled",le.isDis.selNofpp),N("#radioSinglePcb").attr("checked","true"),N("#ptfr4").attr("checked","true"),N("#routingOne").attr("checked","true"),N("#selLayer").val(le.selLayer),N("#selFinishThickness").val(le.selFinishThickness),N("#selMaterial").val(le.selMaterial),N("#selkbsy").val(le.selkbsy),N("#selTg").val(le.selTg),N("#selHf").val(le.selHf),N("#selHc").val(le.selHc),N("#selInlayercoopper").val(le.selInlayercoopper),N("#selInnerMintrack").val(le.selInnerMintrack),N("#selNofcore").val(le.selNofcore),N("#selMinspaccing").val(le.selMinspaccing),N("#selNofpp").val(le.selNofpp),N("#selOuterlayercopper").val(le.selOuterlayercopper),N("#selOutMintrack").val(le.selOutMintrack),N("#selBgasize").val(le.selBgasize),N("#selMinspacing").val(le.selMinspacing),N("#selMinholesize").val(le.selMinholesize),N("#selPthcopper").val(le.selPthcopper),N("#selSoldermc").val(le.selSoldermc),N("#selViaprocess").val(le.selViaprocess),N("#selSilksc").val(le.selSilksc),N("#selPeelable").val(le.selPeelable),N("#selSurfacefinish").val(le.selSurfacefinish),N("#selTestcost").val(le.selTestcost),C.render()}function a(e){if(N("#selLayer").children().remove(),"Aluminum"==e)for(var t=0;t<z.length;t++){var i=z[t].text,n=z[t].value;N("#selLayer").append("<option value="+n+">"+i+"</option>")}else if("FR4"==e)for(var t=0;t<Y.length;t++){var i=Y[t].text,n=Y[t].value;N("#selLayer").append("<option value="+n+">"+i+"</option>"),s(1)}else if("FR4+Aluminum"==e)for(var t=0;t<_.length;t++){var i=_[t].text,n=_[t].value;N("#selLayer").append("<option value="+n+">"+i+"</option>")}}function l(e){if(N("#selMaterial").children().remove(),"Aluminum"==e){for(var t=0;t<Q.length;t++){var i=Q[t].text,n=Q[t].value;N("#selMaterial").append("<option value="+n+">"+i+"</option>")}o("yg")}else{for(var t=0;t<w.length;t++){var i=w[t].text,n=w[t].value;N("#selMaterial").append("<option value="+n+">"+i+"</option>")}o("kb")}C.render("select")}function o(e){if(N("#selkbsy").children().remove(),"kb"==e)for(var t=0;t<O.length;t++){var i=O[t].text,n=O[t].value;N("#selkbsy").append("<option value="+n+">"+i+"</option>")}else if("yg"==e)for(var t=0;t<G.length;t++){var i=G[t].text,n=G[t].value;N("#selkbsy").append("<option value="+n+">"+i+"</option>")}else if("sy"==e)for(var t=0;t<U.length;t++){var i=U[t].text,n=U[t].value;N("#selkbsy").append("<option value="+n+">"+i+"</option>")}C.render("select")}function r(e){var t=e;"1"==t?(oe=N("#singleSizeX").val(),re=N("#singleSizeY").val(),se=N("#quantityPCS").val()):"2"==t&&(ce=N("#panelWayX").val(),ue=N("#panelWayY").val(),pe=N("#quantityPanel").val(),de=N("#panelSizeX").val(),me=N("#panelSizeY").val())}function s(e){c(),2===fe?(le.selLayer=1,le.selMaterial="YG",le.selkbsy="YG0001",le.selHc="1W",le.selMinholesize="1.5",le.selPthcopper="none",le.selSoldermc="white",le.selViaprocess="none",le.selSilksc="black",le.isDis.selHc=!1):3===fe&&(le.selLayer=4,le.selHc="1W",le.selInlayercoopper="1oz",le.selMintrack="5mil",le.selNofcore="1",le.selMinspaccing="5mil",le.selNofpp="2",le.selInnerMintrack="5mil",le.selMinholesize="1.5",le.selPthcopper="none",le.selSoldermc="white",le.selSilksc="black",le.selPeelable="none",le.isDis.selInlayercoopper=!1,le.isDis.selInnerMintrack=!1,le.isDis.selNofcore=!1,le.isDis.selMinspaccing=!1,le.isDis.selNofpp=!1),n()}function c(){le.selLayer=2,le.selFinishThickness="1.6mm",le.selMaterial="KB",le.selkbsy="KB6160",le.selTg="135",le.selHf="NO",le.selHc="none",le.selInlayercoopper="none",le.selMintrack="none",le.selNofcore="none",le.selMinspaccing="none",le.selNofpp="none",le.selOuterlayercopper="1oz",le.selInnerMintrack="none",le.selOutMintrack="5mil",le.selBgasize="0.30",le.selMinspacing="5mil",le.selMinholesize="0.3",le.selPthcopper="20um",le.selSoldermc="green",le.selViaprocess="Follow_gerber",le.selSilksc="white",le.selPeelable="none",le.selSurfacefinish="HASL_with_lead",le.selTestcost="1",le.selCti="175≤CTI<250",le.isDis={},le.isDis.selHc=!0,le.isDis.selInlayercoopper=!0,le.isDis.selInnerMintrack=!0,le.isDis.selNofcore=!0,le.isDis.selMinspaccing=!0,le.isDis.selNofpp=!0}function u(){var e=N("#areasq").val(),t=N("#selLayer").val();N("input[name='buildTime']").remove(),N(".build-time-item .layui-form-radio").remove(),x.req({type:"post",async:!1,url:A.imUrl+"quote/getBuildTime",data:{areaSq:e,layerNum:t},success:function(e){N(".build-time-item").css("display","");var t;N("#selBuildTime").children().remove();for(var i=0;i<e.data.length;i++)N("#selBuildTime").append("<option value="+e.data[i].price+">"+e.data[i].dayNumber+"</option>"),t=e.data[0].dayNumber;Z.buildTime=t,N(".build-time-item input").each(function(){var e=N(this).attr("title");"none"==e&&this.remove()}),C.render()},error:function(){W.msg("Get BuildTime Fail!!!")}})}function p(){var e=null;1===R.bordType?e="selCompany":2===R.bordType?e="selCompanyt":3===R.bordType&&(e="selCompany"),x.req({type:"post",url:A.imUrl+"quote/getCouriers",async:!1,success:function(t){N("select[id='"+e+"'] option").remove(),D.render(e),R.companyId=t.data[0].id;for(var i=0;i<t.data.length;i++)N("select[xm-select='"+e+"']").append("<option value="+t.data[i].id+">"+t.data[i].courierName+"</option>"),j.courierId=t.data[0].id,R.companyId=j.courierId;D.render(e),C.render("select")},error:function(){W.msg("Get Couriers Fail!!!")}})}function d(){var e=null;1===R.bordType?e="selCountrys":2===R.bordType?e="selCountryst":3===R.bordType&&(e="selCountryss"),N("select[id='"+e+"'] option").remove(),D.render(e),C.render(),x.req({type:"post",async:!1,url:A.imUrl+"quote/getCountry",success:function(t){R.countrysId=t.data[0].id;for(var i=0;i<t.data.length;i++)N("select[xm-select='"+e+"']").append("<option value="+t.data[i].id+">"+t.data[i].name+"</option>"),j.countryId=t.data[0].id,R.countrysId=j.countryId;C.render(),D.render(e)},error:function(){W.msg("Get Countrys Fail!!!")}})}function m(e,t){var i;null!=e&&"undefined"!=typeof e&&""!=e||(e=1),null!=t&&"undefined"!=typeof t&&""!=t||(t=70),i=2===R.bordType?H.stencilWeight:R.totalWeight,x.req({type:"post",url:A.imUrl+"quote/getShippingCost",data:{courierId:e,countryId:t,totalWeight:i},success:function(e){null!=e.data&&1===R.bordType?(Z.postFee=e.data.shippingCost,K.postFee=e.data.shippingCost,X.shipping=e.data.shippingCost,N("#shippingPrice").val(X.shipping),y()):null!=e.data&&2===R.bordType?(H.stencil_shippingPrice=ie.postFee=e.data.shippingCost,console.log("stencil_shippingPrice:"+H.stencil_shippingPrice),N("#postFees").val(H.stencil_shippingPrice),b()):N("#shippingPrice").val("不支持该配送")},error:function(){W.msg("Get ShippingCost Fail!!!")}})}function v(){x.req({type:"post",url:A.baseUrl+"sys/consumer/user/all",success:function(e){for(var t=0;t<e.data.length;t++)N("select[xm-select='selCustomer']").append("<option id="+e.data[t].id+" value="+e.data[t].id+">"+e.data[t].userSystemId+"</option>");D.render("selCustomer"),C.render("select")}})}function f(e){var t=0;N.each(e,function(i,n){var a=parseFloat(n);(""==a||null==a||isNaN(a))&&(e[i]=0,a=0),t+=a}),te.pcbCost=t.toFixed(2),N("#pcbCost").val(te.pcbCost),y()}function y(){var e=N("#shippingPrice").val();te.shippingPrice=parseFloat(e),N.each(te,function(e,t){(""==t||null==t||isNaN(t))&&(te[e]=0)});var t=parseFloat(te.pcbCost),e=parseFloat(te.shippingPrice),i=(t+e).toFixed(2);te.totalPrice=i,Z.subtotal=t,V.totalPriced=te.totalPrice,N("#totalPrice").val(te.totalPrice)}function b(){var e;e="Top And Bottom (On Single Stencil)"==ie.stencilSide||"Top"==ie.stencilSide||"Bottom"==ie.stencilSide?1:2,ie.inStencilCost=ie.sQuantity*H.stencilSize_price*e,N("#inStencilCost").val(ie.inStencilCost),g()}function g(){var e=ie,t=e.postFee+e.inStencilCost;ae.totalStencilFee=t,V.totalPricedS=t,N("#stotalPrice").val(t),h()}function h(){var e=parseInt(N("#inStencilCost").val()),t=parseInt(N("#stencil_quantity").val()),i=(e/t).toFixed(2);ne.unitPrice=i,N("#sunitPrice").val(i)}function S(){var e=new Object;return e.enginnerFee=parseFloat(N("#enginnerFee").val()),e.boardFee=parseFloat(N("#boardFee").val()),e.testCostFee=parseFloat(N("#testFee").val()),e.toolingFee=parseFloat(N("#toolingFee").val()),e.overworkFee=parseFloat(N("#urgentFee").val()),e}function P(){N("#inStencilCost").val(""),N("#shippingPrice").val(""),N("#totalPrice").val(""),C.render()}function F(e){J.importPCBInfo=e,N("#inside_quote_all input,#inside_quote_all select").each(function(){var t=N(this).attr("name"),i=N(this),n=N(this).attr("type");(isNaN(e[t])||""==e[t]||null==e[t])&&i.parents(".rig-price").length>0&&(e[t]=0),i.is("input")&&("text"==n||"number"==n?i.val(e[t]):"checkbox"==n?N("input[type=checkbox][name="+t+"][value='"+e[t]+"']").attr("checked","checked"):"radio"==n&&N("input[name="+t+"][value='"+e[t]+"']").prop("checked","checked")),i.is("select")&&(N("select[name='"+t+"'] option[value='"+e[t]+"']").attr("selected",!0),"nOfPp"!=t&&"countries"!=t||N("select[name='"+t+"'] option[value='"+e[t]+"']").attr("selected",!0)),N("*[name='remark']").val(e.remark),"userId"==t&&(N("select[name='userId']").find("option[id="+e.userId+"]").attr("selected",!0),N("input[name='customerId']").val(e.userId),Z.userId=K.customerAid=e.userId)}),N("input[name='customerSysName']").val(N("#selCustomer").find("option:selected").text()),Z.userId=e.userId,Z.gerberName=e.gerberName,Z.gerberPath=e.gerberPath,Z.pcbName=ae.pcbName=e.pcbName,Z.productNo=e.productNo,Z.countries=R.countrysId=e.countries;var t=parseFloat(N("input[name='subtotal']").val()),i=parseFloat(N("input[name='postFee']").val());(isNaN(t)||""==t)&&(t=0),(isNaN(i)||""==i)&&(i=0);var n=t+i;N("input[id='totalPrice']").val(n),C.render(),N(".bot-subbtn").click();var a=Object.assign($,Z);console.log(a),W.msg("导入PCB信息成功")}function I(e){var t,i,n,a,l=k();return e.A.customerSysName=e.B.customerSysName,N.each(e.A,function(o,r){if(i=""==r||null==r||"none"==r,N.each(e.B,function(e,s){n=""==s||null==s||"none"==s,o==e&&(r==s?t=2:i&&n?t=2:r!=s&&"-1"==l.fd.indexOf(o)&&l.fdyg.indexOf(o)&&(console.log("key值不同的q["+o+","+r+"],i["+e+","+s+"]"),l.fdyg.indexOf(o)>=0?(t=3,a=!0):t=2))}),1==a)return!1}),console.log("orderType:===>"+t),t}function k(){var e="",t="";N(".top-m-one input").each(function(){"undefined"!=typeof N(this).attr("name")&&(e+=","+N(this).attr("name"))}),N(".top-price-one input").each(function(){"undefined"!=typeof N(this).attr("name")&&(e+=","+N(this).attr("name"))}),N(".center-m-two input").each(function(){"undefined"!=typeof N(this).attr("name")&&(t+=","+N(this).attr("name"))}),N(".center-m-two select").each(function(){"undefined"!=typeof N(this).attr("name")&&(t+=","+N(this).attr("name"))});var i={fd:e,fdyg:t};return console.log(i),i}var N=layui.jquery,T=layui.view,C=layui.form,x=layui.admin,q=layui.element,A=layui.setter,M=layui.upload,D=layui.formSelects,B=layui.jsTools,W=layui.layer;q.render();var Y=[{text:0,value:0},{text:1,value:1},{text:2,value:2},{text:4,value:4},{text:6,value:6},{text:8,value:8}],z=[{text:0,value:0},{text:1,value:1},{text:2,value:2}],_=[{text:0,value:0},{text:4,value:4},{text:6,value:6},{text:8,value:8}],w=[{text:"KB",value:"KB"},{text:"SY",value:"SY"}],Q=[{text:"YG",value:"YG"}],O=[{text:"KB6160",value:"KB6160"},{text:"KB6150",value:"KB6150"},{text:"KB6165",value:"KB6165"},{text:"KB6167",value:"KB6167"}],U=[{text:"SY1130",value:"SY1130"},{text:"SY1141",value:"SY1141"},{text:"SY1150",value:"SY1150"},{text:"SY1170",value:"SY1170"},{text:"SY1180",value:"SY1180"},{text:"SY1000",value:"SY1000"},{text:"SY1000-2",value:"SY1000-2"},{text:"SY1600",value:"SY1600"}],G=[{text:"YG0001",value:"YG0001"},{text:"YG0002",value:"YG0002"},{text:"YG0003",value:"YG0003"},{text:"YG0004",value:"YG0004"}],L={isDis:{itPanelway:!0,itPanelsize:!0}},R={bordType:1,companyId:1,countrysId:70,totalWeight:0},H={stencilSize_price:"",stencilWeight:"",stencil_shippingPrice:""},K={postFee:"",customerAid:"",ids:"",orderNo:""},j={courierId:"",countryId:"",totalWeight:""},X={shipping:""},V={totalPric:null,totalPriced:null,isQuote:!1,totalPricS:null,totalPricedS:null,isQuoteS:!1},E=null,J={importPCBInfo:null},Z={engineeringFee:"",boardFee:"",testCostFee:"",toolingFee:"",overworkFee:0,buildTime:"",weight:"",postFee:0,subtotal:"",quoteConfigIds:"",productNo:"",userId:"",orderType:1,gerberName:"",gerberPath:"",pcbName:"",orderNo:"",countries:"Afghanistan"},$={},ee={stencilWeight:"",inStencilCost:""},te={pcbCost:0,totalPrice:0,shippingPrice:0},ie={postFee:H.stencil_shippingPrice,inStencilCost:null,sQuantity:1,stencilSide:"Top And Bottom (On Single Stencil)",sunitPrice:H.stencilSize_price,stotalPrice:null},ne=new Object,ae={stencilSide:"Top And Bottom (On Single Stencil)",quantity:ie.sQuantity,thickness:.12,existingFiducials:.1,totalStencilFee:ie.stotalPrice,gerberPath:null,gerberName:null,orderId:null,orderType:1,pcbName:null,postFee:null,orderNo:null,companyId:R.companyId,countrysId:R.countrysId,customerSysName:null,userId:null,productNo:null},le={};c(),n(),i(0),a("FR4"),l(),o("kb"),v();var oe,re,se,ce,ue,pe,de,me,ve=1;N("#singleSizeX,#singleSizeY,#quantityPCS").bind("input propertychange",function(e){t()}),N("#panelSizeX,#panelSizeY,#quantityPanel").bind("input propertychange",function(e){null!=de&&null!=me&&null!=pe&&t()}),N("#panelWayX,#panelWayY,#quantityPanel").bind("input propertychange",function(e){t()}),N("input[name='testPoint']").bind("input propertychange",function(e){setTimeout(function(){N(".up-subbtn").click()},1800)}),N("input[name='panelRoutingPath']").bind("input propertychange",function(e){setTimeout(function(){N(".up-subbtn").click()},1800)}),N("input[name='punchingHoles']").bind("input propertychange",function(e){setTimeout(function(){N(".up-subbtn").click()},1800)}),N("input[name='punchingSlots']").bind("input propertychange",function(e){setTimeout(function(){N(".up-subbtn").click()},1800)}),N("input[name='surfaceArea']").bind("input propertychange",function(e){setTimeout(function(){N(".up-subbtn").click()},1800)}),N("#mPrice").bind("input propertychange",function(e){var t=N("#mPrice").val(),i=N("#areasq").val(),n=parseFloat(t*i).toFixed(2),a=N("#boardFee").val();N("#unitPrice").val(parseFloat(a/i).toFixed(2)),N("#boardFee").val(n),W.msg(n)}),N("#rPcbForm").bind("input propertychange",function(){var e=S();f(e),Z.postFee=parseFloat(N("#shippingPrice").val()),Z.engineeringFee=parseFloat(N("#enginnerFee").val()),Z=Object.assign(Z,e),console.log(Z)}),N("#stencil_quantity").bind("input propertychange",function(){var e=parseFloat(N(this).val());(""==e||null==e||"undefined"==typeof e||isNaN(e))&&(e=0),ie.sQuantity=ae.quantity=e,b()}),C.on("radio(boardType)",function(e){var t=e.value;"1"==t?(ve=1,i(1)):"2"==t&&(ve=2,i(2))}),C.on("select(material)",function(e){var t=e.value;"KB"==t?o("kb"):"SY"==t?o("sy"):"YG"==t&&o("yg")}),C.on("select(selSurfacefinish)",function(e){var t=e.value;"HASL_with_lead"==t||"HASL_lead_free"==t?N("#selSurfacethickness").val("2.54-25.4um"):"Immersion_Gold"==t?N("#selSurfacethickness").val("2u"):"Immersion_tin"==t?N("#selSurfacethickness").val("0.5um-0.7um"):"Immersion_silver"==t?N("#selSurfacethickness").val("≥0.05um"):"OSP"==t&&N("#selSurfacethickness").val("0.25-0.5um"),"Immersion_Gold"==t?N("input[name='surfaceArea']").removeAttr("disabled"):N("input[name='surfaceArea']").attr("disabled",!0),C.render("select","quoteForm"),C.render(null,"quoteForm")}),C.on("select(testPointType)",function(e){var t=e.value;"1"==t?N("#testPointT").text("飞针费："):N("#testPointT").text("测试架："),N(".up-subbtn").click()}),C.on("select(stencilSide)",function(e){var t=e.value;console.log(t),ie.stencilSide=ae.stencilSide=t,b()}),C.on("radio(existingFiducials)",function(e){var t=ae.existingFiducials=e.value;W.msg(t)}),C.on("radio(sthickness)",function(e){var t=ae.thickness=e.value;W.msg(t)}),C.on("radio(routingType)",function(e){var t=e.value;"1"==t?(N("input[name='panelRoutingPath']").removeAttr("disabled"),N("input[name='punchingHoles']").attr("disabled",!0),N("input[name='punchingSlots']").attr("disabled",!0)):(N("input[name='panelRoutingPath']").attr("disabled",!0),N("input[name='punchingHoles']").removeAttr("disabled"),N("input[name='punchingSlots']").removeAttr("disabled")),N(".up-subbtn").click(),C.render()}),q.on("collapse(orderTypeCol)",function(e){var t=e.title.context.innerText;t.indexOf("PCB Phototype")!=-1?(N(".rig-price-cardbody form").removeClass("quote-avtive"),N(".rig-price").addClass("quote-avtive"),N("*[data-type='addThisQuote']").show(),R.bordType=1):t.indexOf("SMT-Stencil")!=-1?(N(".rig-price-cardbody form").removeClass("quote-avtive"),N("#stencilForm").addClass("quote-avtive"),N("*[data-type='addThisQuote']").hide(),R.bordType=2):t.indexOf("Assembly Service")!=-1&&(N(".rig-price-cardbody form").removeClass("quote-avtive"),N("#assemblyForm").addClass("quote-avtive"),R.bordType=3),P()}),C.on("select(layer)",function(e){var t=e.value;le.selLayer=t,"1"==fe&&("1"==t?(le.selPthcopper="none",le.selViaprocess="none"):"2"==t?(le.selPthcopper="20um",le.selViaprocess="Follow_gerber"):"4"==t?(c(),le.selLayer=t,le.selInlayercoopper="1oz",le.isDis.selInlayercoopper=!1,le.selInnerMintrack="5mil",le.isDis.selInnerMintrack=!1,le.selNofcore="1",le.isDis.selNofcore=!1,le.selNofpp="2",le.isDis.selNofpp=!1):"6"==t?(c(),le.selLayer=t,le.selInlayercoopper="1oz",le.isDis.selInlayercoopper=!1,le.selInnerMintrack="5mil",le.isDis.selInnerMintrack=!1,le.selNofcore="2",le.isDis.selNofcore=!1,le.selNofpp="3",le.isDis.selNofpp=!1,le.selPthcopper="none"):"8"==t&&(c(),le.selLayer=t,le.selInlayercoopper="1oz",le.isDis.selInlayercoopper=!1,le.selInnerMintrack="5mil",le.isDis.selInnerMintrack=!1,le.selNofcore="3",le.isDis.selNofcore=!1,le.selNofpp="4",le.isDis.selNofpp=!1,le.selPthcopper="none"),n())});var fe=1;C.on("radio(pcbType)",function(e){var t=e.value;W.msg(t),"FR4"==t?(fe=1,a("FR4"),s(),l("FR4")):"Aluminum"==t?(fe=2,a("Aluminum"),s(),l("Aluminum")):"FR4+Aluminum"==t&&(fe=3,a("FR4+Aluminum"),s(),l("FR4+Aluminum"))}),C.on("radio(buildTimeRadio)",function(e){var t=e.value;console.log(e),console.log(e),Z.overworkFee=t,N("#urgentFee").val(t),f()}),C.on("select(selBuildTime)",function(e){var t=e.value,i=N("#selBuildTime").find("option[value="+e.value+"]").text();te.shippingPrice=t,Z.overworkFee=t,Z.buildTime=i,N("#urgentFee").val(t);var n=S();f(n)}),layui.formSelects.on("selCompany",function(e,t,i,n,a){var l=(i.name,i.value);R.companyId=l;var o=R.companyId,r=R.countrysId;m(o,r),m()}),layui.formSelects.on("selCountrys",function(e,t,i,n,a){var l=(i.name,i.value);R.countrysId=l,Z.countries=R.countrysId,2===R.bordType&&g();var o=R.companyId,r=R.countrysId;m(o,r)}),layui.formSelects.on("selCustomer",function(e,t,i,n,a){var l=i.name,o=i.value;K.customerAid=o,Z.userId=ae.userId=o,ae.customerSysName=l,N("#customerId").val(o),N("input[name='customerSysName']").val(l)}),C.on("select(filterOrderType)",function(e){Z.orderType=ae.orderType=e.value}),N("#postFees").bind("input propertychange",function(e){ie.postFee=parseFloat(N(this).val()),b()}),N("#inStencilCost").bind("input propertychange",function(e){ie.inStencilCost=parseFloat(N(this).val()),g()}),C.on("submit(assemblyService)",function(e){var e=e.field;return x.req({type:"post",data:e,url:A.imUrl+"quote/getAssemblyQuote",success:function(e){var t=N("#pcbQuantity").val(),i=parseFloat(e.data.totalAssemblyQuote/t);N("#pricePCS").val(i.toFixed(2)),N("#assemblyCost").val(e.data.totalAssemblyQuote),null!=e.data.totalAssemblyWeight&&""!=e.data.totalAssemblyWeight&&N("#assemblyWeight").val(e.data.totalAssemblyWeight),console.log(e);e.data.totalAssemblyQuote,e.data.totalAssemblyWeight}}),!1}),N("#panelWayX,#panelWayY,#quantityPanel").keydown(function(e){var t=parseInt(e.keyCode);return 110!=t}),N("#panelWayX,#panelWayY,#quantityPanel").bind("cut copy paste",function(e){e.preventDefault()}),C.on("submit(quoteForm)",function(e){var e=e.field,t=e.cncAndPunch;return $=e,e.isExistSmt=0,e.stackUp="none",e.innerMinTrack=e.innerMinSpacing,e.outerMinSpacing=e.outerMinTrack,e.silkScreenBotColor=e.solderMaskTopColor,e.solderMaskBotColor=e.solderMaskTopColor,e.surfaceArea=e.surfaceArea,e.orderNo=N("#orderNo").val(),Z.orderNo=e.orderNo,e.pcbName=Z.pcbName,2!==ve||null!=e.panelWayX&&""!=e.panelWayX&&null!=e.panelWayY&&""!=e.panelWayY?null==e.testPoint||""==e.testPoint?(N("html,body").animate({scrollTop:200},"slow"),W.msg("请输入测试点数量 !"),!1):"Immersion_Gold"==e.surfaceFinish&&""==e.surfaceArea?(W.msg("请输入沉金面积！"),!1):(x.req({type:"post",url:A.imUrl+"quote/countAdditionInfo",data:e,success:function(e){if(null!=e.data.pcbPriceDetail&&""!=e.data.pcbPriceDetail&&(null==e.data.pcbPriceDetail.qcidList&&""==e.data.pcbPriceDetail.qcidList||(K.ids=e.data.pcbPriceDetail.qcidList,Z.quoteConfigIds=e.data.pcbPriceDetail.qcidList.join(","),K.ids=e.data.pcbPriceDetail.qcidList)),console.log(e),Z.engineeringFee=e.data.projectQuoteToUSD,Z.boardFee=e.data.totalBoardQuoteToUSD,Z.testCostFee=e.data.totalTestPointToUSD,Z.toolingFee=e.data.cncAndPunchingQuoteToUSD,Z.weight=e.data.totalQuoteWeight,R.totalWeight=e.data.totalQuoteWeight,N("#boardFee").val(e.data.totalBoardQuoteToUSD),N("#enginnerFee").val(e.data.projectQuoteToUSD),N("#pcbWeight").val(e.data.totalQuoteWeight+" KG"),N("#testFee").val(e.data.totalTestPointToUSD),N("#flyingTest").val(e.data.totalTestPointToUSD),N("#routingCost").val(e.data.cncAndPunchingQuoteToUSD),N("#unitPrice").val(e.data.unitPrice),j.totalWeight=e.data.totalQuoteWeight,R.totalWeight=e.data.totalQuoteWeight,E=e.data.areaType,"1"==t?N("#toolingFee").val(0):N("#toolingFee").val(e.data.cncAndPunchingQuoteToUSD),"1"==E)N("#mPrice").val(""),N("#mPrice").attr("disabled",!0);else{var i=parseFloat(e.data.totalBoardQuoteToUSD/N("#areasq").val()).toFixed(2);N("#mPrice").val(i),N("#mPrice").removeAttr("disabled")}if(f(),u(),null!=j.courierId&&""!=j.courierId||p(),null!=j.countryId&&""!=j.countryId||d(),null!=R.companyId&&""!=R.companyId&&null!=R.countrysId&&""!=R.countrysId){var n=R.companyId,a=R.countrysId;m(n,a)}var l=S();f(l)},error:function(e){alert("Services Error!!!")}}),C.render(),!1):(W.tips("请输入拼版方式 !","#panelWayX",{tips:[1,"#3595CC"],time:5e3}),!1)}),N(".stencilSide").click(function(){x.popup({title:"Stencil Size",area:["60%","85%"],btn:["确定","取消"],yes:function(e,t){var i=layui.data("stencilList");ne=i.params,H.stencilSize_price=ne.unitPrice,H.stencilWeight=ne.weight,ee.stencilWeight=H.stencilWeight,N("#stencilWeight").val(H.stencilWeight+" KG "),ee.stencilWeight=H.stencilSize_price,N("#inStencilSize").val(N("#stenContainer").val()),p(),d(),m(),W.closeAll()},success:function(e,t){T(this.id).render("marketManagement/iframeWindow/stencil_size_list",null).done(function(){})}})});var ye={resetQuoteTab:function(){N("a[title='刷新']").click(),W.msg("重置报价表")},addCustomerFile:function(){W.msg("添加客户资料")},addThisQuote:function(){var e;N(".up-subbtn").click();var t=Object.assign($,Z);if(null==Z.userId||""==Z.userId)return W.msg("请先选择客户"),!1;if(null==Z.gerberName||""==Z.gerberName)return W.tips("请先上传Gerber资料再添加当前报价 !","#addFile",{tips:[1,"#3595CC"],time:2e3}),!1;if(J.importPCBInfo){var i={A:null,B:null};i.A=t,i.B=J.importPCBInfo,t.orderType=I(i),"2"==t.orderType?e="返单":"3"==t.orderType&&(e="返单有改")}else t.orderType=1,e="新单";V.totalPric==V.totalPriced&&1==V.isQuote?W.confirm("你已经添加了相同参数的报价，是否再次添加？",function(){x.req({type:"post",data:t,url:A.baseUrl+"epc/pcborder/save",success:function(t){N("#orderPN").val(t.pn),Z.productNo=t.pn,C.render(null,"checkCustomer"),"500"!=t.code&&W.alert("添加报价成功["+e+"]")}})}):(x.req({type:"post",data:t,url:A.baseUrl+"epc/pcborder/save",success:function(t){N("#orderPN").val(t.pn),Z.productNo=t.pn,C.render(null,"checkCustomer"),"500"!=t.code&&W.alert("添加报价成功["+e+"]")}}),V.totalPric=V.totalPriced,V.isQuote=!0)},lookQuote:function(){var e=Z.quoteConfigIds;null==K.customerAid||""==K.customerAid?W.msg("请选择对应的客户"):x.popup({title:"产看报价详情",area:["70%","85%"],btn:["确定","取消"],yes:function(e,t){W.closeAll()},success:function(t,i){var n={ids:""};n.ids=Z.quoteConfigIds,T(this.id).render("marketManagement/iframeWindow/quote_detaily",n).done(function(){N("#sss").text(e),N("#sss").attr("name",e)})}})},upSubbtn:function(){if("1"==R.bordType)null==K.customerAid||""==K.customerAid?W.tips("请先选择客户 !","#selCustomer_container",{tips:[1,"#3595CC"],time:2e3}):N(".bot-subbtn").click();else if(2===R.bordType){N(".rStencilSubmit").click();var e=Object.assign(ae,ne);if(e.orderNo=N("#orderNo").val(),e.postFee=ie.postFee,null==e.userId||""==e.userId)return W.msg("请先选择客户"),!1;if(null==e.gerberName||""==e.gerberName)return W.tips("请先上传Gerber资料再添加当前报价 !","#addFile",{tips:[1,"#3595CC"],time:2e3}),!1;V.totalPricS==V.totalPricedS&&1==V.isQuoteS?W.confirm("你已经添加了相同参数的报价，是否再次添加？",function(){x.req({type:"post",data:e,url:A.baseUrl+"epc/stencilorder/save",success:function(e){W.alert("钢网报价成功！"),N("#orderPN").val(e.pn),ae.productNo=e.pn}})}):(x.req({type:"post",data:e,url:A.baseUrl+"epc/stencilorder/save",success:function(e){W.alert("钢网报价成功！"),N("#orderPN").val(e.pn),ae.productNo=e.pn}}),V.totalPricS=V.totalPricedS,V.isQuoteS=!0)}else 3===R.bordType&&N(".rAssemblySubmit").click()}};M.render({elem:"#addFile",url:A.baseUrl+"sys/oss/upload/geber?access_token="+layui.data("layuiAdmin").access_token,field:"file",accept:"file",exts:"zip|rar|7z",before:function(e){e.preview(function(e,t,i){var n=t.name;Z.gerberName=ae.gerberName=n,Z.pcbName=ae.pcbName=B.CleanFileSuffix(n),console.log("显示的文件名为："+Z.pcbName),null==N("#pcbName").val&&""==N("#pcbName").val||N("#pcbName").val(Z.pcbName),C.render(null,"")})},done:function(e,t,i){W.msg("文件上传成功！");var n=e.url,a=/\[(.+?)\]/g,l=n.match(a);console.log("未处理的路径为："+l);var o=l[0].replace(/\[|]/g,"");Z.gerberPath=ae.gerberPath=o,console.log("处理完的路径为："+o)},error:function(){W.msg("文件上传失败！")}});N(".layui-btn").on("click",function(){var e=N(this).data("type");ye[e]?ye[e].call(this):""}),N(".up-rsetbtn").on("click",function(){N(".bot-rsetbtn").click()}),N(".importPcbInfo>.importOrder").on("click",function(){x.popup({title:"导入pcb订单信息",area:["506px","288px"],btn:["导入","取消"],yes:function(e,t){N("#importPCBInfo").click(),W.closeAll()},success:function(e,t){T(this.id).render("marketManagement/iframeWindow/import_pcbInfoForm").done(function(){D.render(),C.on("submit(importPCBInfo)",function(e){return x.req({type:"post",url:A.baseUrl+"pert/revieworder/reviewOrderInfo",data:e.field,success:function(e){var i=e.data;null!=i?(u(),p(),d(),F(i)):W.alert("当前不存在PCB参数详情！"),W.close(t)}}),!1})})}})}),N(".importPcbInfo>.importReOrder").on("click",function(){x.popup({title:"导入返单信息",area:["506px","288px"],btn:["导入","取消"],id:"popupImportReOrder",yes:function(e,t){N("#importRePCBInfo").click(),W.closeAll()},success:function(e,t){T(this.id).render("marketManagement/iframeWindow/import_pcbInfoReOreder").done(function(){C.on("submit(importRePCBInfo)",function(e){e.field;return x.req({type:"post",url:A.baseUrl+"epc/pcborder/findOrderByUidAndProductNo",data:e.field,success:function(e){var i=e.data;null!=i?(u(),p(),d(),F(i)):W.alert("当前不存在PCB参数详情！"),W.close(t)}}),!1})})}})}),N(".importPcbInfo>.quotePostFee").on("click",function(){x.popup({title:"运费计算",area:["660px","322px"],btn:["清空","返回"],id:"popupQuotePostFee",yes:function(){W.msg("清空数据"),N("#quotePostFeeRest").click()},btn1:function(){W.closeAll()},success:function(e,t){T(this.id).render("marketManagement/iframeWindow/quote_postFee").done(function(){C.render()})}})}),e("quote",{})});