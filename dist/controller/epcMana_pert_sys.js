/** layuiAdmin.pro-v1.0.0 LPPL License By http://www.layui.com/admin/ */
 ;"use strict";layui.define(["admin","table","index","element","form","laydate"],function(e){table=layui.table,view=layui.view,admin=layui.admin,form=layui.form,setter=layui.setter,element=layui.element;var t=layui.jquery,r={orderType:1};element.on("tab(tab-planToger)",function(e){console.log(e.index),0===e.index?r.orderType=1:1===e.index?r.orderType=2:2===e.index&&(r.orderType=3)}),table.render({elem:"#epcMana_pertSys",url:setter.baseUrl+"pert/revieworder/list?status=2",toolbar:"#epcMana_pertSys_tb",cellMinWidth:80,id:"epcMana_pertSys",page:!0,parseData:function(e){return{code:0,data:e.page.list,count:e.page.totalCount}},cols:[[{type:"checkbox"},{field:"status",title:"状态",width:110,sort:!0},{field:"customerNo",title:"客户编号",Width:110,sort:!0},{field:"productNo",title:"P/N",minWidth:219,sort:!0},{field:"boardFee",title:"板费",Width:110,sort:!0},{field:"engineeringFee",title:"工程费",Width:110,sort:!0},{field:"overworkFee",title:"加急费",Width:110,sort:!0},{field:"postFee",title:"邮费",Width:110,sort:!0},{field:"testCostFee",title:"测试费",Width:110,sort:!0},{field:"toolingFee",title:"工具费",Width:110,sort:!0},{field:"unitPrice",title:"单价",Width:110,sort:!0},{field:"quoteGerberName",title:"文件名",Width:110,hide:!0},{field:"quoteGerberPath",title:"文件路径",Width:110,hide:!0},{field:"id",title:"ID",hide:!0},{fixed:"right",title:"操作",toolbar:"#epcMana_pertSys_tabbar",width:150}]],done:function(e,t,r){}}),table.on("toolbar(eqcMana_pertSys)",function(e){var r=table.checkStatus(e.config.id),n=new Object;switch(e.event){case"add":n.opType="add";var i=r.data;if(i.length>1)layer.msg("最多只能选择一条数据！");else if(i.length<=0)layer.msg("请选择一条要提交的数据！");else{var l=i[0].id;admin.req({type:"post",url:setter.baseUrl+"pert/pcbinfo/info/"+l,success:function(e){null==e.pcbInfo?admin.popup({title:"添加评审订单",area:["985px","701px"],btn:["保存","取消"],yes:function(e,r){t(".bot-subbtn").click()},success:function(e,t){view(this.id).render("epcManagement/iframeWindow/pert_pcbDetailAdd",i).done(function(){form.on("submit(pertDetailForm)",function(e){var t=e.field;return t.orderId=l,console.log(t),admin.req({type:"post",data:t,url:setter.baseUrl+"pert/pcbinfo/save",success:function(){layer.alert("供应商报价添加成功！",function(){layer.closeAll()})}}),!1}),form.render()})}}):layer.alert("当前评审已经添加了评审订单，请勿重复添加！")}})}break;case"submit":var i=r.data;i.length>1?layer.msg("最多只能选择一条数据！"):i.length<=0?layer.msg("请选择一条要提交的数据！"):admin.req({type:"post",url:setter.baseUrl+"pert/pcbinfo/info/"+i[0].id,success:function(e){null!=e.pcbInfo?layer.confirm("确定提交评审？",function(){admin.req({type:"post",url:setter.baseUrl+"pert/revieworder/update",data:{id:i[0].id,status:3},success:function(){layer.alert("评审提交成功！",function(){table.reload("epcMana_pertSys"),layer.closeAll()})}})}):layer.alert("请先添加pcb报价信息再提交！")}})}}),table.on("tool(eqcMana_pertSys)",function(e){var r=e.data,n=r.id;console.log("_this_id"+n),"edit"==e.event?(r.opType="edit",admin.req({type:"post",url:setter.baseUrl+"pert/pcbinfo/info/"+n,success:function(e){var r={};r.pcbInfo=e.pcbInfo,null!=e.pcbInfo?(t.each(r.pcbInfo,function(e,t){0===t&&(r.pcbInfo[e]=null)}),r.selInfo=new Object,r.selInfo.layerNum=r.pcbInfo.layerNum,r.selInfo.material=r.pcbInfo.material,r.selInfo.productCode=r.pcbInfo.productCode,admin.popup({title:"修改评审订单",area:["985px","701px"],btn:["保存","取消"],yes:function(e,r){t(".bot-subbtn").click()},success:function(e,n){view(this.id).render("epcManagement/iframeWindow/pert_pcbDetail",r).done(function(){form.on("submit(pertDetailForm)",function(e){var n=e.field;return n.id=r.pcbInfo.id,t.each(n,function(e,t){""!=t&&null!=t&&"undefined"!=typeof t||(n[e]=0)}),console.log(n),admin.req({type:"post",data:n,url:setter.baseUrl+"pert/pcbinfo/update",success:function(){layer.alert("供应商报价修改成功！",function(){layer.closeAll()})}}),!1}),form.render()})}})):layer.alert("当前订单不存在pcb参数信息，添加选择表格左上角的添加按钮",function(){layer.closeAll()})}})):"del"==e.event?admin.req({type:"post",url:setter.baseUrl+"pert/pcbinfo/info/"+n,success:function(e){null!=e.pcbInfo?layer.confirm("确定删除？",function(){admin.req({type:"post",data:{ids:r.id},url:setter.baseUrl+"pert/revieworder/delete",success:function(e){layer.alert("评审订单删除成功！"),table.reload("epcMana_pertSys"),layer.closeAll()}})}):layer.alert("当前订单不存在pcb参数信息，添加选择表格左上角的添加按钮",function(){layer.closeAll()})}}):"detail"==e.event&&admin.req({type:"post",url:setter.baseUrl+"pert/pcbinfo/info/"+n,success:function(e){var n=e.pcbInfo;null!=n?admin.popup({title:"查看PCB订单信息",btn:["立即提交","取消"],area:["76%","90%"],yes:function(){t(".submit-ok").click()},success:function(e,t){view(this.id).render("epcManagement/iframeWindow/pert_sysPCB_detail",n).done(function(){console.log(r),form.render(null,""),form.on("submit(LAY-pcborder-update-submit)",function(e){var r=e.field;return console.log("提交的字段信息："+JSON.stringify(r)),admin.req({type:"post",url:setter.baseUrl+"pert/pcbinfo/save",data:r,done:function(e){layer.msg("订单信息修改成功"),layui.table.reload("interior_order_Tabpcb")},fail:function(e){layer.msg("订单信息修改失败，请稍后再试！")}}),layer.close(t),!1})})}}):layer.alert("当前订单不存在pcb参数信息，添加选择表格左上角的添加按钮")}})}),e("epcMana_pert_sys",{})});