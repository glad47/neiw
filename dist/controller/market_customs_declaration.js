/** layuiAdmin.pro-v1.0.0 LPPL License By http://www.layui.com/admin/ */
 ;"use strict";layui.define(["table","form","util","requestInterface","jsTools","convertCurrency","r"],function(t){var e=layui.$,n=layui.admin,a=layui.view,i=layui.table,o=layui.setter,r=layui.form,c=layui.jsTools,l=layui.convertCurrency,s=layui.requestInterface,d=layui.r;r.render(null,"marker-customs-declaration-list"),r.on("submit(market-customs-declaration-search)",function(t){var e=t.field;i.reload("market-customs-declaration-table",{where:e})}),i.render({elem:"#market-customs-declaration-table",id:"market-customs-declaration-table",url:o.baseUrl+"market/customsdeclaration/list",page:!0,parseData:function(t){return{code:0,data:t.page.list,count:t.page.totalCount}},cols:[[{type:"checkbox",fixed:"left"},{field:"id",width:100,title:"ID",sort:!0},{field:"commercialInvoice",title:"发票号（CI）"},{field:"goodsNo",title:"品名号"},{field:"customerNo",title:"客户编号"},{field:"gmtCreate",title:"创建时间",sort:!0,templet:"<div>{{ d.gmtCreate != null ? layui.util.toDateString(d.gmtCreate, 'yyyy-MM-dd') : ''}}</div>"},{title:"操作",width:520,align:"center",fixed:"right",toolbar:"#table-customs-declaration-toolbar"}]]}),i.on("tool(market-customs-declaration-table)",function(t){var e=t.data,i=o.baseUrl+"sys/consumer/user/info/"+e.receiverId,r=s.GetCustomerInfo(i);e.userInfo=r,"packingListEn"===t.event?n.req({type:"post",url:o.baseUrl+"market/customsdeclaration/detailedInfo/"+e.id,success:function(t){return 0===t.data.length?layer.msg("详细为空，请添加数据"):(e.itemEntityList=t.data,void n.popup({title:"装箱单(英)",area:["100%","100%"],id:"LAY-popup-packing-list-en",btn:["打印","取消"],yes:function(t,e){document.body.innerHTML=document.getElementById("market-packing-list-en-print").innerHTML,window.print(),window.location.reload()},success:function(t,n){a(this.id).render("marketManagement/iframeWindow/packing_list_en",e).done(function(){})}}))}}):"packingListCn"===t.event?n.req({type:"post",url:o.baseUrl+"market/customsdeclaration/detailedInfo/"+e.id,success:function(t){return 0===t.data.length?layer.msg("详细为空，请添加数据"):(e.itemEntityList=t.data,void n.popup({title:"装箱单(中)",area:["100%","100%"],id:"LAY-popup-packing-list-cn",btn:["打印","取消"],yes:function(t,e){document.body.innerHTML=document.getElementById("market-packing-list-cn-print").innerHTML,window.print(),window.location.reload()},success:function(t,n){a(this.id).render("marketManagement/iframeWindow/packing_list_cn",e).done(function(){})}}))}}):"contract"===t.event?n.req({type:"post",url:o.baseUrl+"market/customsdeclaration/detailedInfoGroup/"+e.id,success:function(t){if(0===t.data.length)return layer.msg("详细为空，请添加数据");e.itemEntityList=t.data,console.log(t.data);var i=t.data.map(function(t){return Number(t.totalPrice)}).reduce(function(t,e){return t+e}).toFixed(2),o=l.conversion(i),r=c.TimeWeekage(e.orderTime,2);console.log(r),e.tp=i,e.tp2=o,e.tw=r,n.popup({title:"合同",area:["100%","100%"],id:"LAY-popup-packing-list-contract",btn:["打印","取消"],yes:function(t,e){document.body.innerHTML=document.getElementById("market-packing-list-contract-print").innerHTML,window.print(),window.location.reload()},success:function(t,n){a(this.id).render("marketManagement/iframeWindow/packing_list_contract",e).done(function(){})}})}}):"invoice"===t.event?n.req({type:"post",url:o.baseUrl+"market/customsdeclaration/detailedInfoGroup/"+e.id,success:function(t){return 0===t.data.length?layer.msg("详细为空，请添加数据"):(e.itemEntityList=t.data,console.log(e),void n.popup({title:"发票",area:["100%","100%"],id:"LAY-popup-packing-list-invoice",btn:["打印","取消"],yes:function(t,e){document.body.innerHTML=document.getElementById("market-packing-list-invoice-print").innerHTML,window.print(),window.location.reload()},success:function(t,n){a(this.id).render("marketManagement/iframeWindow/packing_list_invoice",e).done(function(){})}}))}}):"declaration"===t.event&&n.req({type:"post",url:o.baseUrl+"market/customsdeclaration/detailedInfoGroup/"+e.id,success:function(t){return 0===t.data.length?layer.msg("详细为空，请添加数据"):(e.itemEntityList=t.data,console.log(e),void n.popup({title:"报关单",area:["100%","100%"],id:"LAY-popup-packing-list-customs",btn:["打印","取消"],yes:function(t,e){document.body.innerHTML=document.getElementById("market-packing-list-customs-print").innerHTML,window.print(),window.location.reload()},success:function(t,n){a(this.id).render("marketManagement/iframeWindow/packing_list_customs",e).done(function(){})}}))}})}),i.on("rowDouble(market-customs-declaration-table)",function(t){u.edit(t.data)});var u={batchdel:function(){var t=i.checkStatus("market-customs-declaration-table"),e=t.data;if(0===e.length)return layer.msg("请选择数据");var n=e.map(function(t){return t.id}).join(",");layer.confirm("确定删除吗？",function(t){d.get("market/customsdeclaration/delete",{ids:n}).then(function(e){layer.msg("已删除"),i.reload("market-customs-declaration-table"),layer.close(t)})})},add:function(t){var e;d.popup("添加报关单",["100%","100%"],["保存","取消"],"marketManagement/iframeWindow/customs_declaration_form",null,"market-customs-declaration-form-submit","market-packing-list-en-table",1).then(function(t){console.log(t);var n=t.formData.field;return e=t.index,n.itemEntityList=t.tableData,d.post("market/customsdeclaration/save",n)}).then(function(t){layer.msg("添加成功！！！"),i.reload("market-customs-declaration-table"),layer.close(e)})},edit:function(t){if(console.log(t),!t){var e=i.checkStatus("market-customs-declaration-table"),n=e.data;if(0===n.length)return layer.msg("请选择数据");if(n.length>1)return layer.msg("只能选择一条数据");t=n[0]}var a;d.get("market/customsdeclaration/detailedInfo/"+t.id,null,!1).then(function(e){return t.itemEntityList=e,d.popup("编辑报关单",["100%","100%"],["修改","取消"],"marketManagement/iframeWindow/customs_declaration_form",t,"market-customs-declaration-form-submit","market-packing-list-en-table",1)}).then(function(t){console.log(t);var e=t.formData.field;return a=t.index,e.itemEntityList=t.tableData,d.post("market/customsdeclaration/update",e)}).then(function(t){layer.msg("修改成功！！！"),i.reload("market-customs-declaration-table"),layer.close(a)})}};e(".layui-btn.layuiadmin-btn-list").on("click",function(){var t=e(this).data("type");u[t]?u[t].call(this):""}),t("market_customs_declaration",{})});