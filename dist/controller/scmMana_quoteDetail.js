/** layuiAdmin.pro-v1.0.0 LPPL License By http://www.layui.com/admin/ */
 ;"use strict";layui.define(["admin","table","index","element","form","convertCurrency"],function(e){function t(){table.render({elem:"#scmMana_tabPcb",url:setter.baseUrl+"/scm/pcborder/quoteDetail/list",toolbar:"#scmMana_toolbar",cellMinWidth:80,id:"scmMana_tabPcb",page:!0,parseData:function(e){return{code:0,data:e.page.list,count:e.page.totalCount}},cols:[[{type:"checkbox"},{field:"status",title:"状态",templet:"#scmManaquo_status",width:115,minWidth:115},{field:"supplierQuoteNo",title:"报价单号",width:172,minWidth:172},{field:"gmtCreate",title:"报价时间",width:166},{field:"supplierNo",title:"供应商编号",width:124},{field:"factoryMake",title:"供应商厂编",width:117},{field:"productNo",title:"聚谷型号",width:124},{field:"pcbName",title:"聚谷物料号",width:144},{field:"quantityPcs",title:"订单数量(PCS)",width:134},{field:"unitPrice",title:"单价",width:96},{field:"engineeringFee",title:"工程费",width:96},{field:"testCostFee",title:"飞针费",width:96},{field:"testCostFee",title:"测试架费",width:96},{field:"toolingFee",title:"模具",width:96},{field:"totalFee",title:"合计",width:96},{field:"remark",title:"报价备注",width:168},{field:"dimensionsX",title:"dimensionsX",hide:!0},{field:"dimensionsY",title:"dimensionsY",hide:!0},{field:"panelSizeX",title:"panelSizeX",hide:!0},{field:"panelSizeY",title:"panelSizeY",hide:!0},{field:"panelWayX",title:"panelWayX",hide:!0},{field:"panelWayY",title:"panelWayY",hide:!0},{field:"unitPriceCustomer",title:"unitPriceCustomer",hide:!0},{field:"engineeringFeeCustomer",title:"engineeringFeeCustomer",hide:!0},{field:"testCostFeeCustomer",title:"testCostFeeCustomer",hide:!0},{field:"toolingFeeCustomer",title:"toolingFeeCustomer",hide:!0},{field:"subtotal",title:"subtotal",hide:!0},{fixed:"right",title:"操作",toolbar:"#scmMana_tabbar",width:160}]],done:function(e,t,i){}})}function i(){table.render({elem:"#scmMana_tabStencil",url:setter.baseUrl+"scm/stencilorder/quoteDetail/list",toolbar:"#scmManaStencil_toolbar",cellMinWidth:80,id:"scmMana_tabStencil",page:!0,parseData:function(e){return{code:0,data:e.page.list,count:e.page.totalCount}},cols:[[{type:"checkbox"},{field:"status",title:"状态",templet:"#scmManaquo_status",width:115,minWidth:115},{field:"supplierQuoteNo",title:"报价单号",width:172,minWidth:172},{field:"gmtCreate",title:"报价时间",width:166},{field:"supplierNo",title:"供应商编号",width:124},{field:"factoryMake",title:"供应商厂编",width:117},{field:"productNo",title:"聚谷型号",width:124},{field:"pcbName",title:"聚谷物料号",width:144},{field:"quantityPcs",title:"订单数量(PCS)",width:134},{field:"unitPrice",title:"单价",width:96},{field:"engineeringFee",title:"工程费",width:96},{field:"testCostFee",title:"飞针费",width:96},{field:"testCostFee",title:"测试架费",width:96},{field:"toolingFee",title:"模具",width:96},{field:"totalFee",title:"合计",width:96},{field:"remark",title:"报价备注",width:168},{field:"dimensionsX",title:"dimensionsX",hide:!0},{field:"dimensionsY",title:"dimensionsY",hide:!0},{field:"panelSizeX",title:"panelSizeX",hide:!0},{field:"panelSizeY",title:"panelSizeY",hide:!0},{field:"panelWayX",title:"panelWayX",hide:!0},{field:"panelWayY",title:"panelWayY",hide:!0},{field:"unitPriceCustomer",title:"unitPriceCustomer",hide:!0},{field:"engineeringFeeCustomer",title:"engineeringFeeCustomer",hide:!0},{field:"testCostFeeCustomer",title:"testCostFeeCustomer",hide:!0},{field:"toolingFeeCustomer",title:"toolingFeeCustomer",hide:!0},{field:"subtotal",title:"subtotal",hide:!0},{fixed:"right",title:"操作",toolbar:"#scmManaStencil_tabbar",width:160}]],done:function(e,t,i){}})}table=layui.table,view=layui.view,admin=layui.admin,form=layui.form,setter=layui.setter,element=layui.element;var l=layui.jquery,a=layui.convertCurrency;t();var n={orderType:1};element.on("tab(tab-scmManagement)",function(e){0===e.index?(n.orderType=1,t()):1===e.index?(n.orderType=2,i()):2===e.index&&(n.orderType=3)}),table.on("toolbar(scmMana_tabPcb)",function(e){var t=table.checkStatus(e.config.id),i=t.data,l=0;if("evScmSubmit"===e.event){var n=null,o={data:{}};o.data=i;for(var r=0;r<i.length;r++){var d=i[r].totalFee;null==n?n+=i[r].id:n=n+","+i[r].id,l+=d}console.log("totalFee:"+l),convertSubtotal=a.conversion(l),o.totalFee=l,o.convertSubtotal=convertSubtotal,console.log(o),admin.popup({title:"PCB合同",area:["100%","100%"],btn:["生成合同","取消"],yes:function(e,t){layer.confirm("是否生成合同?",function(e){admin.req({type:"post",data:{ids:n},url:setter.baseUrl+"/scm/pcborder/createContractBeOt",success:function(e){"0"==e.code&&(layer.alert("提交成功！！"),table.reload("scmMana_tabPcb"),layer.closeAll())}})})},success:function(e,t){view(this.id).render("scmManagement/iframeWindow/outs_contract",o).done(function(){})}})}}),table.on("tool(scmMana_tabPcb)",function(e){var t=e.data;"eevScmedit"==e.event?(layer.msg("编辑操作"),admin.popup({title:"PCB报价协同编辑",area:["50%","80%"],btn:["保存","下载客户资料","取消"],yes:function(e,i){layer.msg("提交信息");var a=new Object;a.id=t.id,a.orderId=t.orderId,a.orderType=n.orderType,a.supplierId=t.supplierId,a.supplierQuoteNo=t.supplierQuoteNo,a.boardFee=t.boardFee,a.testCostFee=l("#qt_pcb_testCostFee").val(),a.engineeringFee=l("#qt_pcb_engineeringFee").val(),a.toolingFee=l("#qt_pcb_toolingFee").val(),a.overworkFee=t.overworkFee,a.deliveryTime=l("#pcbDeliveryDate").val(),a.unitPrice=l("#qt_pcb_unitPrice").val(),a.remark=l("#qRemark").val(),a.status="",a.factoryMake=l("#pcbfactoryMake").val(),a.testPointType=l("#hiddenTestPoint").val(),a.totalFee=l("#qt_pcb_totalFee").text(),console.log(a),admin.req({type:"post",data:a,url:setter.baseUrl+"scm/pcborder/updateQuoteBeOt",success:function(t){layer.alert("供应商报价修改成功"),table.reload("scmMana_tabPcb"),layer.close(e)}})},btn2:function(e,t){return layer.msg("下载资料"),!1},success:function(e,i){view(this.id).render("scmManagement/iframeWindow/quote_detail_pcb",t).done(function(){})}})):"rollback"==e.event?(layer.msg("回退操作"),layer.confirm("确定退回订单["+t.productNo+"]?",function(i){e.del(),admin.req({type:"post",data:{ids:t.id},url:setter.baseUrl+"/scm/pcborder/rollbackQuoteBeOt",success:function(){layer.alert("已退回["+t.productNo+"]"),table.reload("scmMana_tabPcb")}})})):"eevScmdel"==e.event&&layer.confirm("真的删除行么",function(i){e.del(),admin.req({type:"post",data:{ids:t.id},url:setter.baseUrl+"/scm/ordersupplier/delete",success:function(){layer.alert("删除成功！"),table.reload("scmMana_tabPcb")}}),layer.close(i)})}),table.on("toolbar(scmMana_tabStencil)",function(e){var t=table.checkStatus(e.config.id),i=t.data,l=0;if("evScmSubmit"===e.event){var n=null,o={data:{}};o.data=i;for(var r=0;r<i.length;r++){var d=i[r].totalStencilFee;null==n?n+=i[r].id:n=n+","+i[r].id,l+=d}console.log("totalFee:"+l),convertSubtotal=a.conversion(l),o.totalFee=l,o.convertSubtotal=convertSubtotal,console.log(o),admin.popup({title:"PCB合同",area:["100%","100%"],btn:["生成合同","取消"],yes:function(e,t){layer.confirm("是否生成合同?",function(e){admin.req({type:"post",data:{ids:n},url:setter.baseUrl+"scm/stencilorder/createContractBeOt",success:function(e){"0"==e.code&&(layer.alert("提交成功！！"),table.reload("scmMana_tabStencil"),layer.closeAll())}})})},success:function(e,t){view(this.id).render("scmManagement/iframeWindow/outs_contractS",o).done(function(){})}})}}),table.on("tool(scmMana_tabStencil)",function(e){var t=e.data;"eevScmedit"==e.event?(layer.msg("编辑操作"),admin.popup({title:"Stencil 钢网报价协同编辑",area:["50%","80%"],btn:["保存","下载客户资料","取消"],yes:function(e,i){layer.msg("提交信息");var a=new Object;a.id=t.id,a.orderId=t.orderId,a.orderType=n.orderType,a.supplierId=t.supplierId,a.supplierQuoteNo=t.supplierQuoteNo,a.deliveryTime=l("#stencilDeliveryDate").val(),a.unitPrice=l("#qt_stencil_unitPrice").val(),a.remark=l("#sRemark").val(),a.status="",a.factoryMake=l("#stencilfactoryMake").val(),a.totalFee=l("#qt_stencil_totalFee").text(),console.log(a),admin.req({type:"post",data:a,url:setter.baseUrl+"scm/stencilorder/updateQuoteBeOt",success:function(t){layer.alert("供应商报价修改成功"),table.reload("scmMana_tabStencil"),layer.close(e)}})},btn2:function(e,t){return layer.msg("下载资料"),!1},success:function(e,i){view(this.id).render("scmManagement/iframeWindow/quote_detail_stencil",t).done(function(){})}})):"rollback"==e.event?(layer.msg("回退操作"),layer.confirm("确定退回订单sss["+t.productNo+"]?",function(i){e.del(),admin.req({type:"post",data:{ids:t.id},url:setter.baseUrl+"scm/stencilorder/rollbackQuoteBeOt",success:function(){layer.alert("已退回["+t.productNo+"]"),table.reload("scmMana_tabPcb")}})})):"eevScmdel"==e.event&&layer.confirm("真的删除行么",function(i){e.del(),admin.req({type:"post",data:{ids:t.id},url:setter.baseUrl+"/scm/ordersupplier/delete",success:function(){layer.alert("删除成功！"),table.reload("scmMana_tabPcb")}}),layer.close(i)})}),e("scmMana_quoteDetail",{})});