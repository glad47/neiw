/** layuiAdmin.pro-v1.0.0 LPPL License By http://www.layui.com/admin/ */
 ;"use strict";layui.define(["table","form","element"],function(e){var n=layui.$,t=layui.table,l=layui.admin,r=layui.view,i=layui.setter,u=layui.element,a=layui.form;t.render({elem:"#sys_menu",height:780,url:i.baseUrl+"sys/menu/erplist",id:"sys_menu",page:!0,toolbar:!0,limit:10,cols:[[{field:"menuId",title:"ID",sort:!0,minWidth:100,align:"center"},{field:"title",title:"名称",minWidth:144,align:"center"},{field:"parentName",title:"上级菜单",minWidth:106,align:"center"},{field:"icon",title:"图标",minWidth:107,align:"center"},{field:"type",title:"类型",minWidth:107,align:"center",templet:"#menu_type"},{field:"orderNum",width:80,title:"排序号",minWidth:105,align:"center"},{field:"jump",title:"菜单URL",minWidth:106,align:"center"},{field:"perms",title:"授权标识",sort:!0,minWidth:154,align:"center"},{title:"操作",width:165,align:"center",fixed:"right",toolbar:"#menu_opreation"}]]}),t.on("tool(sys_menuTab)",function(e){var n=e.data,t=n.menuId;"del"===e.event?layer.confirm("确定删除此菜单？",function(n){l.req({type:"post",url:i.baseUrl+"sys/menu/erpdelete/"+t,done:function(t){layer.msg("删除成功"),s.menu_refresh(),e.del(),layer.close(n)},fail:function(e){layer.msg("服务器异常，稍后再试！")}}),layer.close(n)}):"edit"===e.event&&l.popup({title:"编辑用户",area:["717px","561px"],success:function(e,o){r(this.id).render("infoManagement/iframeWindow/sys_menuAdd",n).done(function(){a.render(null,"user_menuAdd_form"),a.render(null,"user_menuMe_form"),u.on("tab(menu_tab)",function(e){var n=e.index;"0"==n?a.on("submit(LAY-menu-add-submit)",function(e){var n=e.field;return n.type="0",n.parentId=0,n.menuId=t,console.log(n),l.req({type:"post",url:i.baseUrl+"sys/menu/erpupdate",data:n,done:function(e){console.log(e),layer.msg("目录修改成功"),s.menu_refresh(),layui.table.reload("sys_menu")},fail:function(e){layer.msg("目录修改失败")}}),layer.close(o),!1}):"1"==n?a.on("submit(LAY-menu-me-submit)",function(e){var n=e.field;return n.type="1",n.menuId=t,console.log(n),l.req({type:"post",url:i.baseUrl+"sys/menu/erpupdate",data:n,done:function(e){console.log(e),layer.msg("菜单修改成功"),s.menu_refresh(),layui.table.reload("sys_menu")},fail:function(e){layer.msg("菜单修改失败")}}),layer.close(o),!1}):"2"==n&&a.on("submit(LAY-menu-btn-submit)",function(e){var n=e.field;return n.type="2",n.menuId=t,console.log(n),l.req({type:"post",url:i.baseUrl+"sys/menu/erpupdate",data:n,done:function(e){layer.msg("按钮修改成功"),s.menu_refresh(),layui.table.reload("sys_menu")},fail:function(e){layer.msg("按钮添加失败")}}),layer.close(o),!1})}),a.on("submit(LAY-user-front-submit)",function(e){e.field;return layui.table.reload("sys_menu"),layer.close(o),!1})})}})});var s={menu_add:function(){l.popup({title:"添加菜单",area:["717px","561px"],id:"LAY-popup-menu-add",success:function(e,t){r(this.id).render("/infoManagement/iframeWindow/sys_menuAdd").done(function(){a.render(null,"user_menuAdd_form"),a.render(null,"user_menuMe_form"),u.on("tab(menu_tab)",function(e){var r="0",u=e.index;"0"==u?a.on("submit(LAY-menu-add-submit)",function(e){var n=e.field;return n.parentId=0,n.type="0",console.log(n),l.req({type:"post",url:i.baseUrl+"sys/menu/erpsave",data:n,done:function(e){console.log(e),layer.msg("目录添加成功"),layui.table.reload("sys_menu"),s.menu_refresh()},fail:function(e){layer.msg("菜单添加失败")}}),layer.close(t),!1}):"1"==u?(a.on("select(LAY-menu-men-submit)",function(e){e.value;n("#menuAdd_menuTs").find("option[text=selValue]").attr("selected",!0);var t=n("#menuAdd_menuTs  option:selected").attr("name");r=t}),a.on("submit(LAY-menu-me-submit)",function(e){var n=e.field;return n.type="1",console.log(n),console.log("field.type==>"+n.type),l.req({type:"post",url:i.baseUrl+"sys/menu/erpsave",data:n,done:function(e){console.log(e),layer.msg("菜单添加成功"),layui.table.reload("sys_menu"),s.menu_refresh()},fail:function(e){layer.msg("菜单添加失败")}}),layer.close(t),!1})):"2"==u&&(a.on("select(LAY-menu-btn-submit)",function(e){var t=n("#menuAdd_tabsbtn  option:selected").attr("name");e.value;n("#menuAdd_tabsbtn").find("option[text=selValue]").attr("selected",!0),r=t}),a.on("submit(LAY-menu-btn-submit)",function(e){if(1==r||0==r)return layer.tips("请选择与按钮同级所对应的二级菜单!","#btnSjmenu",{tips:[1,"#0FA6D8"]}),!1;var n=e.field;return n.type="2",l.req({type:"post",url:i.baseUrl+"sys/menu/erpsave",data:n,done:function(e){console.log(e),layer.msg("按钮添加成功"),layui.table.reload("sys_menu"),s.menu_refresh()},fail:function(e){layer.msg("按钮添加失败")}}),layer.close(t),!1}))})})}})},menu_refresh:function(){var e=r("TPL_layout");e.container.siblings().remove(),e.parse(e.container,"refresh")}};n(".layui-btn").on("click",function(){var e=n(this).data("type");s[e]?s[e].call(this):""}),e("sys_menu",{})});