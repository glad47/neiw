/** layuiAdmin.pro-v1.0.0 LPPL License By http://www.layui.com/admin/ */
 ;"use strict";layui.define(["admin","table","index","element","form","uploadCommon","filePathProcess","convertCurrency","requestInterface","r"],function(e){table=layui.table,view=layui.view,admin=layui.admin,form=layui.form,setter=layui.setter,element=layui.element,$=layui.jquery,r=layui.r,uploadCommon=layui.uploadCommon,filePathProcess=layui.filePathProcess,convertCurrency=layui.convertCurrency,requestInterface=layui.requestInterface,form.render(null,"material-purchasing-form-list"),form.on("submit(material-purchasing-search)",function(e){var t=e.field;table.reload("scm_material_purchasing_tab",{where:t})}),table.render({elem:"#scm_material_purchasing_tab",url:setter.baseUrl+"scm/procurement/materialPurchasingList",toolbar:"#scm_material_purchasing_tb",cellMinWidth:80,id:"scm_material_purchasing_tab",page:!0,parseData:function(e){return{code:0,data:e.page.list,count:e.page.totalCount}},cols:[[{type:"checkbox",fixed:"left"},{field:"productNo",title:"产品型号",width:135,fixed:"left",sort:!0},{field:"productSpecification",title:"产品规格",width:110,sort:!0},{field:"productSize",title:"产品尺寸",width:110,sort:!0},{field:"number",title:"数量",width:200,sort:!0},{field:"unitPrice",title:"单价",width:110,sort:!0},{field:"unit",title:"单位",width:200,sort:!0},{field:"totalPrice",title:"总价",width:183,sort:!0},{field:"deliveryTime",title:"交期",width:177,sort:!0},{field:"remark",title:"备注",width:177,sort:!0},{field:"gmtCreate",title:"创建时间",width:177,sort:!0},{fixed:"right",title:"操作",toolbar:"#scm_material_purchasing_tab_tabbar",width:140}]],done:function(e,t,a){}}),table.on("toolbar(scm_material_purchasing_tab)",function(e){var t=table.checkStatus(e.config.id),a=t.data;switch(console.log(a),e.event){case"add":admin.popup({title:"添加物料采购",area:["733px","532px"],id:"LAY-popup-scm-material-purchasing-add",btn:["保存","取消"],yes:function(e,t){$("#scm-material-purchasin-edit-add-sumbit").click()},success:function(e,t){view(this.id).render("scmManagement/iframeWindow/material_purchasing_edit_add").done(function(){form.render(null,"scm-material-purchasin-edit-add-form"),form.on("submit(scm-material-purchasin-edit-add-sumbit)",function(e){var a=e.field;return admin.req({type:"post",url:setter.baseUrl+"scm/procurement/save",data:a,success:function(e){layer.msg("添加物料采购成功"),layui.table.reload("scm_material_purchasing_tab"),layer.close(t)}}),!1})})}});break;case"create-contract":if(0==a.length){layer.msg("请选择数据");break}for(var r,i=a.length-1;i>=0;i--)if(null==r)r=a[i].supplier;else if(null!=r&&a[i].supplier!=r)return layer.alert("请选择相同的供应商!"),!1;a.supplierInfo=requestInterface.GetSupplierInfo(setter.baseUrl+"sys/supplier/info/"+a[0].supplierId),admin.popup({title:"物料采购合同",area:["100%","100%"],btn:["生成合同","取消"],id:"LAY-popup-scm-material-purchasing-create",yes:function(e,t){layer.confirm("是否生成合同?",function(t){$.ajax({type:"post",headers:{access_token:layui.data("layuiAdmin").access_token},data:JSON.stringify(a),contentType:"application/json;charset=utf-8",url:setter.baseUrl+"scm/procurement/createContractBeMp",success:function(t){0==t.code&&(layer.alert("提交成功！！"),layer.close(e)),table.reload("scm_material_purchasing_tab")}})})},success:function(e,t){view(this.id).render("scmManagement/iframeWindow/outs_contract_mp",a).done(function(){console.log(a)})}})}}),table.on("tool(scm_material_purchasing_tab)",function(e){var t=e.data,a=t.id;"edit"==e.event?admin.popup({title:"编辑物料采购",area:["733px","532px"],id:"LAY-popup-scm-material-puchasing-edit",btn:["保存","取消"],yes:function(e,t){$("#scm-material-purchasin-edit-add-sumbit").click()},success:function(e,a){view(this.id).render("scmManagement/iframeWindow/material_purchasing_edit_add",t).done(function(){form.render(null,"scm-material-purchasin-edit-add-form"),form.on("submit(scm-material-purchasin-edit-add-sumbit)",function(e){var t=e.field;return admin.req({type:"post",url:setter.baseUrl+"scm/procurement/update",data:t,success:function(e){layer.msg("更新物料采购成功"),layui.table.reload("scm_material_purchasing_tab"),layer.close(a)}}),!1})})}}):"del"==e.event&&layer.confirm("确定删除？",{btn:["删除","取消"],btn1:function(e,t){admin.req({type:"post",data:{ids:a},url:setter.baseUrl+"scm/procurement/delete",success:function(){table.reload("scm_material_purchasing_tab"),layer.close(e),layer.msg("删除成功")}})}})}),form.render(null,"scm-purchase-contract-form-list"),form.on("submit(LAY-scm-purchase-contract-search)",function(e){var t=e.field;table.reload("scm_purchase_contract_tab",{where:t})}),table.render({elem:"#scm_purchase_contract_tab",url:setter.baseUrl+"scm/procurement/purchaseContractList",cellMinWidth:80,id:"scm_purchase_contract_tab",page:!0,parseData:function(e){return{code:0,data:e.page.list,count:e.page.totalCount}},cols:[[{type:"checkbox",fixed:"left"},{field:"productNo",title:"产品型号",width:135,fixed:"left",sort:!0},{field:"productSpecification",title:"产品规格",width:110,sort:!0},{field:"productSize",title:"产品尺寸",width:110,sort:!0},{field:"number",title:"数量",width:200,sort:!0},{field:"unitPrice",title:"单价",width:110,sort:!0},{field:"unit",title:"单位",width:200,sort:!0},{field:"totalPrice",title:"总价",width:183,sort:!0},{field:"deliveryTime",title:"交期",width:177,sort:!0},{field:"remark",title:"备注",width:177,sort:!0},{field:"gmtCreate",title:"创建时间",width:177,sort:!0},{fixed:"right",title:"操作",toolbar:"#scm_purchase_contract_tab_tabbar",width:210}]],done:function(e,t,a){}}),table.on("tool(scm_purchase_contract_tab)",function(e){var t=e.data;"ckht"==e.event?admin.req({type:"post",url:setter.baseUrl+"scm/procurement/findByOrderNo",data:{orderNo:t.orderNo},async:!1,success:function(e){var t=e.data;t[0].supplierInfo=requestInterface.GetSupplierInfoByCompanyName(setter.baseUrl+"sys/supplier/getByCompanyName/"+t[0].supplier),admin.popup({title:"物料采购合同",area:["100%","100%"],btn:["打印","取消"],yes:function(e,t){document.body.innerHTML=document.getElementById("outsContract_mp").innerHTML,window.print(),window.location.reload()},success:function(e,a){view(this.id).render("scmManagement/iframeWindow/outs_contract_mp",t).done(function(){})}})}}):"th"==e.event?layer.confirm("确定退回？",{btn:["确定","取消"],btn1:function(a,r){admin.req({type:"post",data:{orderNo:t.orderNo},url:setter.baseUrl+"scm/procurement/backBeOne",success:function(){e.del(),layer.close(a),layer.msg("退回成功")}})}}):"pcedit"==e.event&&admin.popup({title:"编辑物料采购",area:["733px","532px"],id:"LAY-popup-scm-puchasing-contract-edit",btn:["保存","取消"],yes:function(e,t){$("#scm-material-purchasin-edit-add-sumbit").click()},success:function(e,a){view(this.id).render("scmManagement/iframeWindow/material_purchasing_edit_add",t).done(function(){form.render(null,"scm-material-purchasin-edit-add-form"),form.on("submit(scm-material-purchasin-edit-add-sumbit)",function(e){var t=e.field;return admin.req({type:"post",url:setter.baseUrl+"scm/procurement/update",data:t,success:function(e){layer.msg("更新物料采购成功"),layui.table.reload("scm_purchase_contract_tab"),layer.close(a)}}),!1})})}})});var t={"import":function(e){if(!e){var t=table.checkStatus("scm_purchase_contract_tab"),a=t.data;if(0===a.length)return layer.msg("请选择数据");if(a.length>1)return layer.msg("只能选择一条数据");e=a[0]}var i;r.popup("导入物料数据",["733px","532px"],["导入","取消"],"scmManagement/iframeWindow/material_purchasing_edit_add",e,"scm-material-purchasin-edit-add-sumbit",null,0).then(function(e){console.log(e);var t=e.formData.field;return i=e.index,r.get("scm/procurement/save",t,!0)}).then(function(e){layer.msg("导入添加成功！！！"),layer.close(i)})}};$(".layui-btn.layuiadmin-btn-list").on("click",function(){var e=$(this).data("type");t[e]?t[e].call(this):""}),e("scm_materialPurchasing",{})});