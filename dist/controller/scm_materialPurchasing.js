/** layuiAdmin.pro-v1.0.0 LPPL License By http://www.layui.com/admin/ */
 ;"use strict";layui.define(["admin","table","index","element","form","uploadCommon","filePathProcess","convertCurrency"],function(e){table=layui.table,view=layui.view,admin=layui.admin,form=layui.form,setter=layui.setter,element=layui.element,$=layui.jquery,uploadCommon=layui.uploadCommon,filePathProcess=layui.filePathProcess,convertCurrency=layui.convertCurrency,table.render({elem:"#scm_material_purchasing_tab",url:setter.baseUrl+"scm/procurement/materialPurchasingList",toolbar:"#scm_material_purchasing_tb",cellMinWidth:80,id:"scm_material_purchasing_tab",page:!0,parseData:function(e){return{code:0,data:e.page.list,count:e.page.totalCount}},cols:[[{type:"checkbox",fixed:"left"},{field:"productNo",title:"产品型号",width:130,fixed:"left"},{field:"productSpecification",title:"产品规格",width:110},{field:"productSize",title:"产品尺寸",width:110},{field:"number",title:"数量",width:200},{field:"unitPrice",title:"单价",width:110},{field:"unit",title:"单位",width:200},{field:"totalPrice",title:"总价",width:183},{field:"deliveryTime",title:"交期",width:177},{field:"remark",title:"备注",width:177},{field:"gmtCreate",title:"创建时间",width:177},{fixed:"right",title:"操作",toolbar:"#scm_material_purchasing_tab_tabbar",width:210}]],done:function(e,t,a){}}),table.on("toolbar(scm_material_purchasing_tab)",function(e){var t=table.checkStatus(e.config.id),a=t.data;switch(console.log(a),e.event){case"add":admin.popup({title:"添加物料采购",area:["733px","532px"],btn:["保存","取消"],yes:function(e,t){$("button[lay-filter='scm_add_material_purchasing_submit']").click(),table.reload("scm_material_purchasing_tab")},success:function(e,t){view(this.id).render("scmManagement/iframeWindow/material_purchasing_edit_add").done(function(){})}});break;case"create-contract":if(0==a.length){layer.msg("请选择数据");break}for(var i,r=a.length-1;r>=0;r--)if(null==i)i=a[r].supplier;else if(null!=i&&a[r].supplier!=i)return layer.alert("请选择相同的供应商!"),!1;admin.popup({title:"物料采购合同",area:["100%","100%"],btn:["生成合同","取消"],yes:function(e,t){layer.confirm("是否生成合同?",function(e){$.ajax({type:"post",headers:{access_token:layui.data("layuiAdmin").access_token},data:JSON.stringify(a),contentType:"application/json;charset=utf-8",url:setter.baseUrl+"scm/procurement/createContractBeMp",success:function(e){0==e.code&&(layer.alert("提交成功！！"),table.reload("scm_material_purchasing_tb"),layer.closeAll())}})})},success:function(e,t){view(this.id).render("scmManagement/iframeWindow/outs_contract_mp",a).done(function(){})}})}}),table.on("tool(scm_material_purchasing_tab)",function(e){var t=e.data,a=t.id;"edit"==e.event?admin.popup({title:"物料采购编辑",area:["733px","532px"],btn:["保存","取消"],yes:function(e,t){$("button[lay-filter='scm_add_material_purchasing_submit']").click(),table.reload("scm_material_purchasing_tab")},success:function(e,a){view(this.id).render("scmManagement/iframeWindow/material_purchasing_edit_add",t).done(function(){})}}):"del"==e.event&&layer.confirm("确定删除？",{btn:["删除","取消"],btn1:function(t,i){admin.req({type:"post",data:{ids:a},url:setter.baseUrl+"scm/procurement/delete",success:function(){e.del(),layer.close(t),layer.msg("删除成功")}})}})}),form.on("submit(material-purchasing-search)",function(e){var t=e.field;table.reload("scm_material_purchasing_tab",{where:t})}),table.render({elem:"#scm_purchase_contract_tab",url:setter.baseUrl+"scm/procurement/purchaseContractList",cellMinWidth:80,id:"scm_purchase_contract_tab",page:!0,parseData:function(e){return{code:0,data:e.page.list,count:e.page.totalCount}},cols:[[{type:"checkbox",fixed:"left"},{field:"productNo",title:"产品型号",width:130,fixed:"left"},{field:"productSpecification",title:"产品规格",width:110},{field:"productSize",title:"产品尺寸",width:110},{field:"number",title:"数量",width:200},{field:"unitPrice",title:"单价",width:110},{field:"unit",title:"单位",width:200},{field:"totalPrice",title:"总价",width:183},{field:"deliveryTime",title:"交期",width:177},{field:"remark",title:"备注",width:177},{field:"gmtCreate",title:"创建时间",width:177},{fixed:"right",title:"操作",toolbar:"#scm_purchase_contract_tab_tabbar",width:210}]],done:function(e,t,a){}}),table.on("tool(scm_purchase_contract_tab)",function(e){var t=e.data;"ckht"==e.event?admin.req({type:"post",url:setter.baseUrl+"scm/procurement/findByOrderNo",data:{orderNo:t.orderNo},async:!1,success:function(e){var t=e.data;admin.popup({title:"物料采购合同",area:["100%","100%"],btn:["打印","取消"],yes:function(e,t){document.body.innerHTML=document.getElementById("outsContract_mp").innerHTML,window.print(),window.location.reload()},success:function(e,a){view(this.id).render("scmManagement/iframeWindow/outs_contract_mp",t).done(function(){})}})}}):"th"==e.event&&layer.confirm("确定退回？",{btn:["确定","取消"],btn1:function(a,i){admin.req({type:"post",data:{orderNo:t.orderNo},url:setter.baseUrl+"scm/procurement/backBeOne",success:function(){e.del(),layer.close(a),layer.msg("退回成功")}})}})}),form.on("submit(purchase-contract-search)",function(e){var t=e.field;table.reload("scm_purchase_contract_tab",{where:t})}),$(".material-purchasing-form-search input").bind("input propertychange",function(e){$("*[lay-filter='material-purchasing-search']").click()}),$(".purchase-contract-form-search input").bind("input propertychange",function(e){$("*[lay-filter='purchase-contract-search']").click()}),e("scm_materialPurchasing",{})});