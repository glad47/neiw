/** layuiAdmin.pro-v1.0.0 LPPL License By http://www.layui.com/admin/ */
 ;"use strict";layui.define(["admin","table","element","form","edit_customer_info"],function(e){var t=layui.table,i=layui.jquery,s=(layui.element,layui.admin),r=layui.form,o=(layui.edit_customer_info,layui.view),l=layui.setter;r.render(null,"customer-info-formlist"),t.render({elem:"#customer_listTab",url:l.baseUrl+"sys/consumer/user/list",cellMinWidth:80,cols:[[{field:"id",title:"id",sort:!0,width:80},{field:"userType",title:"客户来源",sort:!0,templet:"#userType",width:130},{field:"status",title:"状态",width:130,templet:"#customerStatus"},{field:"userSystemId",title:"客户代码",sort:!0,width:130},{field:"businessName",title:"跟单员",width:100},{field:"userName",title:"用户名",width:130},{field:"country",title:"国家",sort:!0},{field:"email",title:"邮箱",sort:!0,minWidth:196},{field:"gmtCreate",title:"注册时间",sort:!0},{field:"gmtModified",title:"更新时间",sort:!0},{field:"userIp",title:"注册IP",sort:!0,hide:!0},{field:"skypeId",title:"Skype",sort:!0,hide:!0},{field:"receiverTelephone",title:"收货电话",minWidth:120,sort:!0,hide:!0},{field:"googleId",title:"Google",sort:!0,align:"right",hide:!0},{field:"facebookId",title:"Facebook",sort:!0,align:"right",hide:!0},{field:"receiverCompany",title:"公司名",sort:!0,align:"right",hide:!0},{field:"receiverAddress",title:"收货地址",sort:!0,align:"right",hide:!0},{field:"receiverCity",title:"收货城市",sort:!0,hide:!0},{field:"jobrole",title:"工作角色",sort:!0,hide:!0},{field:"contact",title:"联系人",sort:!0,hide:!0},{field:"businessType",title:"业务类型",sort:!0,hide:!0},{field:"applications",title:"应用",sort:!0,hide:!0},{fixed:"right",align:"center",toolbar:"#role-table-operate-barDemo",title:"操作",width:250}]],done:function(e,t,s){i(".layui-table tr div").each(function(){i(this).text().indexOf("已审核")>0&&i(this).parents("tr").children("td:last").find("a[lay-event='customerInfosh']").remove()})},page:!0}),r.on("submit(LAY-app-constomer-info-search)",function(e){var i=e.field;t.reload("customer_listTab",{where:i})}),t.on("tool(customer_listTab)",function(e){var n=e.data;console.log(n),"edit"===e.event?s.req({type:"post",data:{userId:n.id},url:l.baseUrl+"sys/receiveradders/queryReceiverAddersByUid",success:function(e){n.receiverAddersEntityList=e.data,s.popup({title:"编辑客户",area:["80%","100%"],id:"LAY-popup-customer-edit",btn:["提交","取消"],yes:function(e,t){i("#layuiadmin-app-form-submit").click()},success:function(e,i){o(this.id).render("/infoManagement/iframeWindow/customer_edit_info",n).then(function(e){}).done(function(){r.render(null,"customer-add-edit-form-list"),r.on("submit(customer-edit-info-form-submit)",function(e){var r=t.cache["sys-customer-address-list-table"].filter(function(e){return!Array.isArray(e)}),o=e.field;console.log(r);for(var n=0;n<r.length;n++)r[n].LAY_CHECKED?r[n].isDefault=1:r[n].isDefault=0;o.receiverAddersEntityList=r,void 0!==o.delIdArr&&""!==o.delIdArr?o.addDelIdList=o.delIdArr.split(","):o.addDelIdList=[],console.log(o);var d=layer.load(1,{shade:[.1,"#fff"]});s.req({url:l.baseUrl+"sys/consumer/user/update",type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(o),success:function(e){layer.close(d),0===e.code&&(layer.msg("修改成功!"),layui.table.reload("customer_listTab"),layer.close(i))}})})})}})}}):"del"===e.event?layer.confirm("确定删除此客户？",function(e){s.req({url:l.baseUrl+"sys/consumer/user/delete",type:"POST",data:{ids:n.id},success:function(e){layui.table.reload("customer_listTab"),layer.msg("已删除")}})}):"conversionCustomer"===e.event?s.popup({type:1,title:"选择跟单员",btn:["转换","取消"],area:["400px","400px"],yes:function(){i("*[lay-filter='conversionCustomer-submit']").click()},success:function(e,t){o(this.id).render("/infoManagement/iframeWindow/conversionCustomer",n).done(function(){r.render()})}}):"customerInfosh"===e.event&&s.popup({type:1,title:"审核",btn:["审核","取消"],area:["396px","299px"],id:"popupCustomerInfosh",yes:function(){layer.confirm("确定提交审核？",function(){i("input[lay-filter='customersh-submit']").click()})},success:function(){o(this.id).render("/infoManagement/iframeWindow/customer_sh",n).done(function(){r.render()})}})});var n={customerInfo_add:function(){s.popup({id:"LAY-popup-customer-add",title:"客户新增",area:["80%","100%"],btn:["确定","取消"],yes:function(e,t){i("#layuiadmin-app-form-submit").click()},success:function(e,i){o(this.id).render("/infoManagement/iframeWindow/customer_edit_info").then(function(e){console.log(e)}).done(function(){r.render(null,"customer-add-edit-form-list"),r.on("submit(customer-edit-info-form-submit)",function(e){for(var r=t.cache["sys-customer-address-list-table"],o=e.field,n=0;n<r.length;n++)r[n].LAY_CHECKED?r[n].isDefault=1:r[n].isDefault=0;o.receiverAddersEntityList=r,console.log(o);var d=layer.load(1,{shade:[.1,"#fff"]});s.req({url:l.baseUrl+"sys/consumer/user/save",type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(o),success:function(e){layer.close(d),layer.msg("添加成功!"),layui.table.reload("customer_listTab"),layer.close(i)}})})})}})}};i(".layui-btn").on("click",function(){var e=i(this).data("type");n[e]&&n[e].call(this)}),e("sys_coustomer",{})});