/** layuiAdmin.pro-v1.0.0 LPPL License By http://www.layui.com/admin/ */
 ;"use strict";layui.define(["admin","table","index","element","form","laydate","jsTools","requestInterface","uploadCommon","filePathProcess"],function(e){function t(){d.render({elem:"#inside_cotract_Tabpcb",url:n.baseUrl+"epc/pcborder/internalContract",toolbar:"#inside_cotract_option",cellMinWidth:80,id:"inside_cotract_Tabpcb",page:!0,parseData:function(e){return{code:0,data:e.page.list,count:e.page.totalCount}},cols:[[{type:"checkbox",fixed:"left"},{field:"productNo",title:"内部编码",width:135,fixed:"left",sort:!0},{field:"orderType",title:"订单类型",edit:"text",width:110,templet:"#order_type",sort:!0},{field:"gerberName",title:"文件名",edit:"text",width:160,sort:!0},{field:"pcbName",title:"F/N",edit:"text",width:130,sort:!0},{field:"orderNo",title:"客户PO",edit:"text",sort:!0},{field:"quoteOrderNo",title:"报价单号",edit:"text",width:130,sort:!0},{field:"gmtCreate",title:"创建时间",edit:"text",sort:!0},{field:"gmtModified",title:"修改时间",edit:"text",sort:!0},{field:"pcbType",title:"PCB类型",edit:"text",minWidth:130,hide:!0},{field:"dimensionsX",title:"单只(X)",edit:"text",hide:!0},{field:"dimensionsY",title:"单只(Y)",edit:"text",hide:!0},{field:"panelSizeX",title:"Panel(X)",edit:"text",width:90,hide:!0},{field:"panelSizeY",title:"Panel(Y)",edit:"text",width:90,hide:!0},{field:"panelWayX",title:"PanelWay(X)",edit:"text",width:110,hide:!0},{field:"panelWayY",title:"PanelWay(Y)",edit:"text",width:110,hide:!0},{field:"finishThickness",title:"板厚",edit:"text",hide:!0},{field:"layerNum",title:"层数",edit:"text",width:80,hide:!0},{field:"surfaceFinish",title:"表面处理",edit:"text",hide:!0},{field:"quantityPcs",title:"PCS数量",edit:"text",hide:!0},{field:"quantityPanel",title:"Panel数量",edit:"text",hide:!0},{field:"engineeringFee",title:"工程费",edit:"text",hide:!0},{field:"boardFee",title:"板费",edit:"text",hide:!0},{field:"testCostFee",title:"测试费",edit:"text",hide:!0},{field:"toolingFee",title:"工具费",edit:"text",hide:!0},{field:"overworkFee",title:"加急费",edit:"text",hide:!0},{field:"postFee",title:"运费",edit:"text",hide:!0},{field:"subtotal",title:"总价",edit:"text",hide:!0},{field:"boardType",title:"出货方式",edit:"text",hide:!0},{field:"status",title:"状态",align:"center",templet:"#Tabtb-pcb-market-iQuote-status",width:110,hide:!0},{field:"areaSq",title:"面积",edit:"text",hide:!0},{field:"material",title:"材料",edit:"text",hide:!0},{field:"productCode",title:"材料型号",edit:"text",hide:!0},{field:"productNo",title:"材料商",edit:"text",hide:!0},{field:"tg",title:"TG",edit:"text",hide:!0},{field:"cti",title:"CTI",edit:"text",hide:!0},{field:"halogenFree",title:"无卤素",edit:"text",hide:!0},{field:"outerLayerCopper",title:"外层铜厚",edit:"text",hide:!0},{field:"innerLayerCopper",title:"内层铜厚",edit:"text",hide:!0},{field:"heatConductivity",title:"导热系数",edit:"text",hide:!0},{field:"silkScreenTopColor",title:"字符颜色",edit:"text",hide:!0},{field:"solderMaskTopColor",title:"阻焊颜色",edit:"text",hide:!0},{field:"pthCopper",title:"孔铜",edit:"text",hide:!0},{field:"remark",title:"备注",edit:"text",hide:!0},{field:"buildTime",title:"交期",edit:"text",hide:!0},{field:"weight",title:"重量",edit:"text",hide:!0},{field:"thickness",title:"表面处理厚度",edit:"text",hide:!0},{field:"surfaceArea",title:"沉金面积",edit:"text",hide:!0},{field:"minHoleSize",title:"最小孔",edit:"text",hide:!0},{field:"nofHoles",title:"孔数",edit:"text",hide:!0},{field:"viaProcess",title:"过孔方式",edit:"text",hide:!0},{field:"stackUp",title:"压合",edit:"text",hide:!0},{field:"status",title:"状态",edit:"text",hide:!0},{field:"nofCore",title:"芯板数量",edit:"text",hide:!0},{field:"nofPp",title:"PP数量",edit:"text",hide:!0},{field:"innerMinSpacing",title:"内层(线宽/线距)",edit:"text",hide:!0},{field:"outerMinSpacing",title:"外层最小(线宽/线距)",edit:"text",hide:!0},{field:"bgaSize",title:"BGA大小",edit:"text",hide:!0},{field:"testPoinType",title:"测试类型",edit:"text",hide:!0},{field:"testPoint",title:"测试点",edit:"text",hide:!0},{field:"testPointType",title:"测试方式",edit:"text",hide:!0},{field:"userId",title:"用户ID",edit:"text",hide:!0},{field:"uuid",title:"uuid",edit:"text",hide:!0},{field:"panelRoutingPath",title:"锣程",edit:"text",hide:!0},{field:"bevellingCamfer",title:"斜边",edit:"text",hide:!0},{field:"blindHoles",title:"盲孔",edit:"text",hide:!0},{field:"buriedHoles",title:"埋孔",edit:"text",hide:!0},{field:"carbon",title:"碳油",edit:"text",hide:!0},{field:"contrlImpeance",title:"阻抗",edit:"text",hide:!0},{field:"deepMillRouting",title:"控深锣",edit:"text",hide:!0},{field:"punchingHoles",title:"冲孔数",edit:"text",hide:!0},{field:"punchingSlots",title:"冲槽数",edit:"text",hide:!0},{field:"peelable",title:"兰胶",edit:"text",hide:!0},{field:"peelableBrand",title:"兰胶型号",edit:"text",hide:!0},{field:"edgePlated",title:"金属边",edit:"text",hide:!0},{field:"halfHoleLated",title:"半孔板",edit:"text",hide:!0},{field:"orderId",title:"订单ID",edit:"text",hide:!0},{field:"orderNo",title:"订单号",edit:"text",hide:!0},{field:"invoiceNo",title:"合同号",edit:"text",hide:!0},{field:"id",title:"ID",hide:!0},{field:"userId",title:"User ID",hide:!0},{field:"gerberPath",title:"gerberPath",edit:"text",hide:!0},{field:"isExistIndicator",title:"isExistIndicator",edit:"text",hide:!0},{field:"isExistSmt",title:"isExistSmt",edit:"text",hide:!0},{field:"quoteConfigIdList",title:"quoteConfigIdList",edit:"text",hide:!0},{field:"quoteConfigIds",title:"quoteConfigIds",edit:"text",hide:!0},{field:"quoteGerberName",title:"quoteGerberName",edit:"text",hide:!0},{field:"quoteGerberPath",title:"quoteGerberPath",edit:"text",hide:!0},{field:"silkScreenBotColor",title:"silkScreenBotColor",edit:"text",hide:!0},{field:"solderMaskBotColor",title:"solderMaskBotColor",edit:"text",hide:!0},{fixed:"right",title:"操作",toolbar:"#inside_cotract_Bar",width:260}]],done:function(e,t,i){var d=e.data;h=d}})}function i(){d.render({elem:"#icontract_Tabstencil",url:n.baseUrl+"epc/stencilorder/internalContract",toolbar:"#inside_cotract_option",cellMinWidth:80,id:"icontract_Tabstencil",page:!0,parseData:function(e){return{code:0,data:e.page.list,count:e.page.totalCount}},cols:[[{type:"checkbox",fixed:"left"},{field:"productNo",title:"内部编码",width:135,fixed:"left",sort:!0},{field:"orderType",title:"订单类型",edit:"text",Width:110,templet:"#order_type",sort:!0},{field:"gerberName",title:"文件名",edit:"text",minWidth:160,sort:!0},{field:"pcbName",title:"F/N",edit:"text",minWidth:130,sort:!0},{field:"orderNo",title:"客户PO",edit:"text",sort:!0},{field:"quoteOrderNo",title:"报价单号",edit:"text",minWidth:130,sort:!0},{field:"gmtCreate",title:"创建时间",edit:"text",sort:!0},{field:"gmtModified",title:"修改时间",edit:"text",sort:!0},{field:"pcbType",title:"PCB类型",edit:"text",minWidth:130,hide:!0},{field:"dimensionsX",title:"单只(X)",edit:"text",hide:!0},{field:"dimensionsY",title:"单只(Y)",edit:"text",hide:!0},{field:"panelSizeX",title:"Panel(X)",edit:"text",width:90,hide:!0},{field:"panelSizeY",title:"Panel(Y)",edit:"text",width:90,hide:!0},{field:"panelWayX",title:"PanelWay(X)",edit:"text",width:110,hide:!0},{field:"panelWayY",title:"PanelWay(Y)",edit:"text",width:110,hide:!0},{field:"finishThickness",title:"板厚",edit:"text",hide:!0},{field:"layerNum",title:"层数",edit:"text",width:80,hide:!0},{field:"surfaceFinish",title:"表面处理",edit:"text",hide:!0},{field:"quantityPcs",title:"PCS数量",edit:"text",hide:!0},{field:"quantityPanel",title:"Panel数量",edit:"text",hide:!0},{field:"engineeringFee",title:"工程费",edit:"text",hide:!0},{field:"boardFee",title:"板费",edit:"text",hide:!0},{field:"testCostFee",title:"测试费",edit:"text",hide:!0},{field:"toolingFee",title:"工具费",edit:"text",hide:!0},{field:"overworkFee",title:"加急费",edit:"text",hide:!0},{field:"postFee",title:"运费",edit:"text",hide:!0},{field:"subtotal",title:"总价",edit:"text",hide:!0},{field:"boardType",title:"出货方式",edit:"text",hide:!0},{field:"status",title:"状态",align:"center",templet:"#Tabtb-pcb-market-iQuote-status",width:110,hide:!0},{field:"areaSq",title:"面积",edit:"text",hide:!0},{field:"material",title:"材料",edit:"text",hide:!0},{field:"productCode",title:"材料型号",edit:"text",hide:!0},{field:"productNo",title:"材料商",edit:"text",hide:!0},{field:"tg",title:"TG",edit:"text",hide:!0},{field:"cti",title:"CTI",edit:"text",hide:!0},{field:"halogenFree",title:"无卤素",edit:"text",hide:!0},{field:"outerLayerCopper",title:"外层铜厚",edit:"text",hide:!0},{field:"innerLayerCopper",title:"内层铜厚",edit:"text",hide:!0},{field:"heatConductivity",title:"导热系数",edit:"text",hide:!0},{field:"silkScreenTopColor",title:"字符颜色",edit:"text",hide:!0},{field:"solderMaskTopColor",title:"阻焊颜色",edit:"text",hide:!0},{field:"pthCopper",title:"孔铜",edit:"text",hide:!0},{field:"remark",title:"备注",edit:"text",hide:!0},{field:"buildTime",title:"交期",edit:"text",hide:!0},{field:"weight",title:"重量",edit:"text",hide:!0},{field:"thickness",title:"表面处理厚度",edit:"text",hide:!0},{field:"surfaceArea",title:"沉金面积",edit:"text",hide:!0},{field:"minHoleSize",title:"最小孔",edit:"text",hide:!0},{field:"nofHoles",title:"孔数",edit:"text",hide:!0},{field:"viaProcess",title:"过孔方式",edit:"text",hide:!0},{field:"stackUp",title:"压合",edit:"text",hide:!0},{field:"status",title:"状态",edit:"text",hide:!0},{field:"nofCore",title:"芯板数量",edit:"text",hide:!0},{field:"nofPp",title:"PP数量",edit:"text",hide:!0},{field:"innerMinSpacing",title:"内层(线宽/线距)",edit:"text",hide:!0},{field:"outerMinSpacing",title:"外层最小(线宽/线距)",edit:"text",hide:!0},{field:"bgaSize",title:"BGA大小",edit:"text",hide:!0},{field:"testPoinType",title:"测试类型",edit:"text",hide:!0},{field:"testPoint",title:"测试点",edit:"text",hide:!0},{field:"testPointType",title:"测试方式",edit:"text",hide:!0},{field:"userId",title:"用户ID",edit:"text",hide:!0},{field:"uuid",title:"uuid",edit:"text",hide:!0},{field:"panelRoutingPath",title:"锣程",edit:"text",hide:!0},{field:"bevellingCamfer",title:"斜边",edit:"text",hide:!0},{field:"blindHoles",title:"盲孔",edit:"text",hide:!0},{field:"buriedHoles",title:"埋孔",edit:"text",hide:!0},{field:"carbon",title:"碳油",edit:"text",hide:!0},{field:"contrlImpeance",title:"阻抗",edit:"text",hide:!0},{field:"deepMillRouting",title:"控深锣",edit:"text",hide:!0},{field:"punchingHoles",title:"冲孔数",edit:"text",hide:!0},{field:"punchingSlots",title:"冲槽数",edit:"text",hide:!0},{field:"peelable",title:"兰胶",edit:"text",hide:!0},{field:"peelableBrand",title:"兰胶型号",edit:"text",hide:!0},{field:"edgePlated",title:"金属边",edit:"text",hide:!0},{field:"halfHoleLated",title:"半孔板",edit:"text",hide:!0},{field:"orderId",title:"订单ID",edit:"text",hide:!0},{field:"orderNo",title:"订单号",edit:"text",hide:!0},{field:"invoiceNo",title:"合同号",edit:"text",hide:!0},{field:"id",title:"ID",hide:!0},{field:"userId",title:"User ID",hide:!0},{field:"gerberPath",title:"gerberPath",edit:"text",hide:!0},{field:"isExistIndicator",title:"isExistIndicator",edit:"text",hide:!0},{field:"isExistSmt",title:"isExistSmt",edit:"text",hide:!0},{field:"quoteConfigIdList",title:"quoteConfigIdList",edit:"text",hide:!0},{field:"quoteConfigIds",title:"quoteConfigIds",edit:"text",hide:!0},{field:"quoteGerberName",title:"quoteGerberName",edit:"text",hide:!0},{field:"quoteGerberPath",title:"quoteGerberPath",edit:"text",hide:!0},{field:"silkScreenBotColor",title:"silkScreenBotColor",edit:"text",hide:!0},{field:"solderMaskBotColor",title:"solderMaskBotColor",edit:"text",hide:!0},{fixed:"right",title:"操作",toolbar:"#inside_cotract_BarS",width:220}]],done:function(e,t,i){var d=e.data;p=d}})}var d=layui.table,l=layui.view,o=layui.admin,r=layui.form,n=layui.setter,a=layui.element,s=layui.jquery,c=layui.jsTools,u=layui.requestInterface,f=(layui.uploadCommon,layui.filePathProcess);r.render(null,"market-inside-contract-formlist"),t();var h,p,m={orderType:0,customerSn:null},x={userName:"",companyName:"",country:"",city:"",address:"",mobilePhone:"",postcode:""};a.on("tab(inside-contract-tabs-brief)",function(e){m.orderType=e.index,0===m.orderType?t():1===m.orderType?i():2===m.orderType}),r.on("submit(LAY-app-inside-contract-search)",function(e){var t,i=e.field,l=m.orderType;0===l?t="inside_cotract_Tabpcb":1===l&&(t="icontract_Tabstencil"),d.reload(t,{where:i})}),d.on("toolbar(inside_cotract_Tabpcb)",function(e){var t=d.checkStatus(e.config.id),i=t.data,r={data:{}};r.data=t.data;for(var a=0,u=0;u<i.length;u++)a+=parseFloat(i[u].totalFee);switch(r.total=a,e.event){case"submit":for(var f=null,h=null,p=null,u=0;u<i.length;u++){var m=i[u].productNo.substring(0,3);if(null==f?f=i[u].invoiceNo:null!=f&&"-1"==f.indexOf(i[u].invoiceNo)&&(f+=","+i[u].invoiceNo),null!=h&&h!=m)return layer.alert("请选择同一个客户下单"),!1;h=m,null==p?p=i[u].id:p+=","+i[u].id}console.log("qids:"+p);var x,y="marketManagement/iframeWindow/quote_contractB",b=null;o.req({type:"get",data:"",url:n.baseUrl+"sys/consumer/user/info/"+i[0].userId,success:function(e){r.userName=e.user.userName,r.companyName=e.user.companName,r.country=e.user.country,r.city=e.user.city,r.address=e.user.address,r.mobilePhone=e.user.mobilePhone,r.postcode=e.user.postcode,r.paymentType=e.user.paymentType,r.deliveryType=e.user.deliveryType,r.contact=e.user.contact,r.isMilitaryProject=e.user.isMilitaryProject,o.popup({title:"内部合同",area:["100%","100%"],btn:["生成合同","打印","关闭"],maxmin:!0,yes:function(e,t){layer.confirm("确定生成合同编号吗？",function(){o.req({type:"post",data:{qids:p},url:n.baseUrl+"epc/pcborder/createContractNo",success:function(){layer.alert("提交成功！"),layui.table.reload("inside_cotract_Tabpcb"),layer.close(e)}})})},btn2:function(e,t){document.body.innerHTML=document.getElementById("quoteContract_AllB").innerHTML,window.print(),window.location.reload()},success:function(e,i){r.htmlType=1,console.log(r),l(this.id).render(y,r).done(function(){if(b=null,1===x){var e,i=s(".contract-module-three-tab tbody tr").eq(0).find("td").size(),d=t.data.length;d<4?e=4:d>4&&(e=7);for(var l=i;l<e;l++)s(".contract-module-three-tab tbody").find("tr").append("<td></td>");if(4==e)for(var l=1;l<e;l++)s(".contract-module-three-tab tbody tr").find("td").eq(l).css({width:"27.3%"});else for(var l=1;l<e;l++)s(".contract-module-three-tab tbody tr").find("td").eq(l).css({width:"13.6%"})}var o,r=[],n=[];if(null!=t.data){for(var a=0,l=0;l<t.data.length;l++)r[l]=t.data[l].gmtModified,n[l]=t.data[l].gmtCreate,null==r[l]&&a++;a==t.data.length?(o=c.TimeContrast(n),console.log(n)):o=c.TimeContrast(r),s("#contractBotDate").text(o.substring(0,10)),s("#topDate").text(o.substring(0,10))}})}})}})}}),d.on("tool(inside_cotract_Tabpcb)",function(e){var t=e.data;console.log(t);for(var i=t.quoteOrderNo,d=new Object,a=0,u=0,p=0;p<h.length;p++)i==h[p].quoteOrderNo&&(console.log("sd_len:"+a),d[a]=h[p],a+=1,u+=h[p].totalFee),console.log("pcbtabObj[i].invoiceNo:"+h[p].quoteOrderNo);var m=t.quoteOrderNo;if("del"===e.event)layer.confirm("确定退回报价单号为［"+m+"］",function(t){o.req({type:"post",data:{quoteOrderNo:m},url:n.baseUrl+"epc/pcborder/backInternalContract",success:function(){layer.alert("已退回报价单号为［"+m+"］"),e.del(),layui.table.reload("inside_cotract_Tabpcb"),layer.close(t)}})});else if("search-contract"===e.event){var x={data:{}};o.req({type:"get",data:"",url:n.baseUrl+"sys/consumer/user/info/"+t.userId,success:function(e){x.userName=e.user.userName,x.companyName=e.user.companName,x.country=e.user.country,x.city=e.user.city,x.address=e.user.address,x.mobilePhone=e.user.mobilePhone,x.postcode=e.user.postcode,x.paymentType=e.user.paymentType,x.deliveryType=e.user.deliveryType,x.contact=e.user.contact,x.isMilitaryProject=e.user.isMilitaryProject,o.req({type:"post",data:{quoteOrderNo:m},url:n.baseUrl+"epc/pcborder/infoByQuoteOrderNo",success:function(e){var t,i,r=null;x.data=d,x.total=u,console.log(x),s.each(e.data,function(e,d){null==r||""==r?(i=1,r=d.productNo,t="marketManagement/iframeWindow/quote_contractA"):null!=r&&r!=d.productNo&&(i=2,t="marketManagement/iframeWindow/quote_contractB",layer.msg("选择了不同型号"))}),o.popup({title:"内部合同",area:["100%","100%"],btn:["打印","关闭"],maxmin:!0,yes:function(e,t){var d;"1"==i?d="quoteContract_AllA":"2"==i&&(d="quoteContract_AllB"),document.body.innerHTML=document.getElementById(d).innerHTML,window.print(),window.location.reload()},success:function(e,o){x.htmlType=1,console.log(x),l(this.id).render(t,x).done(function(){if(r=null,1===i){var e,t=s(".contract-module-three-tab tbody tr").eq(0).find("td").size();x.data.length;a<4?e=4:a>4&&(e=7);for(var l=t;l<e;l++)s(".contract-module-three-tab tbody").find("tr").append("<td></td>");if(4==e)for(var l=1;l<e;l++)s(".contract-module-three-tab tbody tr").find("td").eq(l).css({width:"27.3%"});else for(var l=1;l<e;l++)s(".contract-module-three-tab tbody tr").find("td").eq(l).css({width:"13.6%"})}var o,n=[],u=[];if(null!=d){for(var f=0,l=0;l<a;l++)n[l]=d[l].gmtModified,u[l]=d[l].gmtCreate,null==n[l]&&f++;f==a?(o=c.TimeContrast(u),console.log(u)):o=c.TimeContrast(n),s("#contractBotDate").text(o.substring(0,10)),s("#topDate").text(o.substring(0,10))}})}})}})}})}else"search-list"===e.event?(layer.msg("查看数据明细"),t.tabId="inside_cotract_Tabpcb",o.popup({title:"编辑PCB订单信息",area:["820px","90%"],btn:["立即提交","取消"],yes:function(){s(".submit-ok").click(),layer.msg("yes")},success:function(e,i){l(this.id).render("marketManagement/iframeWindow/orderPCB_update",t).done(function(){r.render(null,"")})}})):"inside_contract_fileMana"==e.event&&(t.orderType="pcbOrder",t.retab="inside_cotract_Tabpcb",t=f.isInternal(t),console.log(t),o.popup({title:"PCB订单资料管理",area:["870px","303px"],success:function(e,i){l(this.id).render("epcManagement/iframeWindow/file_management",t).done(function(){})},end:function(){localStorage.removeItem("saveBackResult")}}))}),d.on("row(inside_cotract_Tabpcb)",function(e){var t=e.data;o.req({type:"get",data:"",url:n.baseUrl+"sys/consumer/user/info/"+t.userId,success:function(e){x.userName=e.user.userName,x.companyName=e.user.companName,x.country=e.user.country,x.city=e.user.city,x.address=e.user.address}})}),d.on("tool(icontract_Tabstencil)",function(e){for(var t=e.data,i=t.quoteOrderNo,r=new Object,a=0,c=0,u=0;u<p.length;u++)i==p[u].quoteOrderNo&&(r[a]=p[u],a+=1,c+=p[u].totalStencilFee);var h=t.quoteOrderNo;if("del"===e.event)layer.confirm("确定退回报价单号为［"+h+"］",function(t){o.req({type:"post",data:{quoteOrderNo:h},url:n.baseUrl+"epc/stencilorder/backInternalContract",success:function(){layer.alert("已退回报价单号为［"+h+"］"),e.del(),layui.table.reload("icontract_Tabstencil"),layer.close(t)}})});else if("search-contract"===e.event){var m={data:{}};o.req({type:"get",data:"",url:n.baseUrl+"sys/consumer/user/info/"+t.userId,success:function(e){m.userName=e.user.userName,m.companyName=e.user.companName,m.country=e.user.country,m.city=e.user.city,m.address=e.user.address,m.mobilePhone=e.user.mobilePhone,m.postcode=e.user.postcode,m.contact=e.user.contact,o.req({type:"post",data:{quoteOrderNo:h},url:n.baseUrl+"epc/pcborder/infoByQuoteOrderNo",success:function(e){var t,i="marketManagement/iframeWindow/quote_contractS",d=null;m.data=r,m.total=c,s.each(e.data,function(e,i){null==d||""==d?(t=1,d=i.productNo):null!=d&&d!=i.productNo&&(t=2)}),o.popup({title:"内部合同",area:["100%","100%"],btn:["打印","关闭"],maxmin:!0,yes:function(e,t){var i="quoteContract_AllS";document.body.innerHTML=document.getElementById(i).innerHTML,window.print(),window.location.reload()},success:function(e,t){m.htmlType=1,l(this.id).render(i,m).done(function(){console.log(m),d=null})}})}})}})}else"search-list"===e.event?(layer.msg("查看数据明细"),o.popup({title:"编辑 Stencil钢网 订单信息",area:["885px","550px"],btn:["立即提交","取消"],yes:function(){s(".submitStencilUpB").click(),d.reload("icontract_Tabstencil")},success:function(e,i){l(this.id).render("marketManagement/iframeWindow/orderStencil_updateB",t).done(function(){})}})):"inside_contract_fileMana"==e.event&&(t.orderType="stencilOrder",t.retab="icontract_Tabstencil",t=f.isInternal(t),console.log(t),o.popup({title:"PCB订单资料管理",area:["45%","40%"],success:function(e,i){l(this.id).render("epcManagement/iframeWindow/file_management",t).done(function(){})},end:function(){localStorage.removeItem("saveBackResult")}}))}),d.on("toolbar(icontract_Tabstencil)",function(e){var t=d.checkStatus(e.config.id),i=t.data,r={data:{}};r.data=t.data;for(var a=0,f=0;f<i.length;f++)a+=parseFloat(i[f].totalStencilFee);r.total=a;var h=u.ContractGetUserInfo(n.baseUrl+"sys/consumer/user/info/"+i[0].userId);switch(r.userName=h.userName,r.companyName=h.companName,r.country=h.country,r.city=h.city,r.address=h.address,r.mobilePhone=h.mobilePhone,r.postcode=h.postcode,r.contact=h.contact,r.paymentType=h.paymentType,r.deliveryType=h.deliveryType,e.event){case"submit":for(var p=null,m=null,x=i.map(function(e){return e.id}).join(","),f=0;f<i.length;f++){var y=i[f].productNo.substring(0,3);if(null==p?p=i[f].invoiceNo:null!=p&&"-1"==p.indexOf(i[f].invoiceNo)&&(p+=","+i[f].invoiceNo),null!=m&&m!=y)return layer.alert("请选择同一个客户下单"),!1;m=y}var b="marketManagement/iframeWindow/quote_contractS",g=null;o.popup({title:"内部合同",area:["100%","100%"],btn:["生成合同","打印","关闭"],maxmin:!0,yes:function(e,t){layer.confirm("确定生成合同编号吗？",function(){o.req({type:"post",data:{sids:x},url:n.baseUrl+"epc/stencilorder/createContractNo",success:function(){layer.alert("提交成功！"),d.reload("icontract_Tabstencil"),layer.close(e)}})})},btn2:function(e,t){document.body.innerHTML=document.getElementById("quoteContract_AllB").innerHTML,window.print(),window.location.reload()},success:function(e,i){r.htmlType=1,l(this.id).render(b,r).done(function(){g=null;var e,i=[],d=[];if(null!=t.data){for(var l=0,o=0;o<t.data.length;o++)i[o]=t.data[o].gmtModified,d[o]=t.data[o].gmtCreate,null==i[o]&&l++;l==t.data.length?(e=c.TimeContrast(d),console.log(d)):e=c.TimeContrast(i),s("#contractBotDateS").text(e.substring(0,10)),s("#topDate").text(e.substring(0,10))}})}})}}),e("market_insideContract",{})});