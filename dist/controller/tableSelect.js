/** layuiAdmin.pro-v1.0.0 LPPL License By http://www.layui.com/admin/ */
 ;"use strict";layui.define(["table","jquery","form"],function(e){var t="tableSelect",a=layui.jquery,c=layui.table,l=layui.form,i=function(){this.v="1.1.0"};i.prototype.render=function(e){var t=a(e.elem),i=e.table.done||function(){};e.searchKey=e.searchKey||"keyword",e.searchPlaceholder=e.searchPlaceholder||"关键词搜索",e.checkedKey=e.checkedKey,e.table.page=e.table.page||!0,e.table.height=e.table.height||315,t.off("click").on("click",function(n){function r(t,l,i){for(var n=0;n<t.data.length;n++)for(var r=0;r<b.length;r++)if(t.data[n][e.checkedKey]==b[r][e.checkedKey]){t.data[n].LAY_CHECKED=!0;var o=t.data[n].LAY_TABLE_INDEX,h=a("#"+p).next().find("tr[data-index="+o+'] input[type="checkbox"]');h.prop("checked",!0).next().addClass("layui-form-checked");var s=a("#"+p).next().find("tr[data-index="+o+'] input[type="radio"]');s.prop("checked",!0).next().addClass("layui-form-radioed").find("i").html("&#xe643;")}var u=c.checkStatus(p);u.isAll&&(a("#"+p).next().find('.layui-table-header th[data-field="0"] input[type="checkbox"]').prop("checked",!0),a("#"+p).next().find('.layui-table-header th[data-field="0"] input[type="checkbox"]').next().addClass("layui-form-checked")),d(b.length)}function o(a,c,l){if(e.checkedKey&&t.attr("ts-selected")){for(var i=t.attr("ts-selected").split(","),n=0;n<a.data.length;n++)for(var r=0;r<i.length;r++)a.data[n][e.checkedKey]==i[r]&&b.push(a.data[n]);b=h(b,e.checkedKey)}}function d(e){y.find(".tableSelect_btn_select span").html(0==e?"":"("+e+")")}function h(e,t){var a=[],c=[];if(0==e.length)return e;if(t){for(var l=0;l<e.length;l++)c[e[l][t]]||(a.push(e[l]),c[e[l][t]]=!0);return a}for(var l=0;l<e.length;l++)c[e[l]]||(a.push(e[l]),c[e[l]]=!0);return a}function s(a){if(e.checkedKey){for(var l=[],i=0;i<a.data.length;i++)l.push(a.data[i][e.checkedKey]);t.attr("ts-selected",l.join(","))}e.done(t,a),y.remove(),delete c.cache[p],b=[]}if(n.stopPropagation(),a("div.tableSelect").length>=1)return!1;var u=t.offset().top+t.outerHeight()+"px",f=t.offset().left+"px",p="tableSelect_table_"+(new Date).getTime(),y='<div class="tableSelect layui-anim layui-anim-upbit" style="left:'+f+";top:"+u+';border: 1px solid #d2d2d2;background-color: #fff;box-shadow: 0 2px 4px rgba(0,0,0,.12);padding:10px 10px 0 10px;position: absolute;z-index:66666666;margin: 5px 0;border-radius: 2px;min-width:530px;">';y+='<div class="tableSelectBar">',y+='<form class="layui-form" action="" style="display:inline-block;">',y+='<input style="display:inline-block;width:190px;height:30px;vertical-align:middle;margin-right:-1px;border: 1px solid #C9C9C9;" type="text" name="'+e.searchKey+'" placeholder="'+e.searchPlaceholder+'" autocomplete="off" class="layui-input"><button class="layui-btn layui-btn-sm layui-btn-primary tableSelect_btn_search" lay-submit lay-filter="tableSelect_btn_search"><i class="layui-icon layui-icon-search"></i></button>',y+="</form>",y+='<button style="float:right;" class="layui-btn layui-btn-sm tableSelect_btn_select">选择<span></span></button>',y+="</div>",y+='<table id="'+p+'" lay-filter="'+p+'"></table>',y+="</div>",y=a(y),a("body").append(y);var b=[];e.table.elem="#"+p,e.table.id=p,e.table.done=function(e,t,a){o(e,t,a),r(e,t,a),i(e,t,a)};var g=c.render(e.table);c.on("radio("+p+")",function(t){e.checkedKey&&(b=c.checkStatus(p).data),d(c.checkStatus(p).data.length)}),c.on("checkbox("+p+")",function(t){if(e.checkedKey){if(t.checked)for(var a=0;a<c.checkStatus(p).data.length;a++)b.push(c.checkStatus(p).data[a]);else if("all"==t.type)for(var l=0;l<c.cache[p].length;l++)for(var a=0;a<b.length;a++)b[a][e.checkedKey]==c.cache[p][l][e.checkedKey]&&b.splice(a,1);else for(var i=function(){for(var t="",a=0;a<c.cache[p].length;a++)c.cache[p][a].LAY_CHECKED||(t=c.cache[p][a][e.checkedKey]);return t},n=t.data[e.checkedKey]||i(),a=0;a<b.length;a++)b[a][e.checkedKey]==n&&b.splice(a,1);b=h(b,e.checkedKey),d(b.length)}else d(c.checkStatus(p).data.length)}),c.on("edit("+p+")",function(e){var t=e.value,a=e.data,c=e.field;layer.msg("[ID: "+a.id+"] "+c+" 字段更改为："+t)});var k=t.offset().top+t.outerHeight()+y.outerHeight()-a(window).scrollTop()>a(window).height(),v=t.offset().left+y.outerWidth()>a(window).width();k&&y.css({top:"auto",bottom:"0px"}),v&&y.css({left:"auto",right:"5px"}),l.on("submit(tableSelect_btn_search)",function(e){return g.reload({where:e.field,page:{curr:1}}),!1}),y.find(".tableSelect_btn_select").on("click",function(){var e=c.checkStatus(p);b.length>1&&(e.data=b),s(e)}),a(document).mouseup(function(t){var l=a(""+e.elem+",.tableSelect");l.is(t.target)||0!==l.has(t.target).length||(y.remove(),delete c.cache[p],b=[])})})},i.prototype.hide=function(e){a(".tableSelect").remove()};var i=new i;window.top==window.self&&a(window).scroll(function(){i.hide()}),e(t,i)});