/** layuiAdmin.pro-v1.0.0 LPPL License By http://www.layui.com/admin/ */
 ;"use strict";layui.define(["admin","table","index","element","form","convertCurrency","requestInterface","formSelects"],function(e){function t(){table.render({elem:"#scmManaOutSCA_tabPcb",url:setter.baseUrl+"scm/pcborder/outsourcingContractAll/list",cellMinWidth:80,id:"scmManaOutSCA_tabPcb",page:!0,parseData:function(e){return{code:0,data:e.page.list,count:e.page.totalCount}},cols:[[{type:"checkbox",fixed:"left"},{field:"productNo",title:"聚谷型号",width:135,sort:!0},{field:"supplierNo",title:"供应商编号",width:124,sort:!0},{field:"status",title:"状态",templet:"#og_statusA",minWidth:104,sort:!0},{field:"gmtCreate",title:"创建时间",width:166,sort:!0},{field:"pcbName",title:"聚谷物料号",width:144,sort:!0},{field:"quantityPcs",title:"订单数量(PCS)",width:134,sort:!0},{field:"unitPrice",title:"单价",width:96,sort:!0},{field:"engineeringFee",title:"工程费",width:96,sort:!0},{field:"",title:"飞针费",width:96,sort:!0,templet:'<div>{{ d.testPointType == 1 ? d.testCostFee : "" }}</div>'},{field:"",title:"测试架费",width:96,sort:!0,templet:'<div>{{ d.testPointType != 1 ? d.testCostFee : "" }}</div>'},{field:"toolingFee",title:"模具",width:96,sort:!0},{field:"totalFee",title:"合计",width:96,sort:!0},{field:"remark",title:"订单备注",width:168,sort:!0},{field:"supplierContractNo",title:"合同编号",minWidth:171,sort:!0},{field:"factoryMake",title:"供应商厂编",minWidth:190,sort:!0},{field:"dimensionsX",title:"dimensionsX",hide:!0},{field:"dimensionsY",title:"dimensionsY",hide:!0},{field:"panelSizeX",title:"panelSizeX",hide:!0},{field:"panelSizeY",title:"panelSizeY",hide:!0},{field:"panelWayX",title:"panelWayX",hide:!0},{field:"panelWayY",title:"panelWayY",hide:!0},{field:"unitPriceCustomer",title:"unitPriceCustomer",hide:!0},{field:"engineeringFeeCustomer",title:"engineeringFeeCustomer",hide:!0},{field:"testCostFeeCustomer",title:"testCostFeeCustomer",hide:!0},{field:"toolingFeeCustomer",title:"toolingFeeCustomer",hide:!0},{field:"subtotal",title:"subtotal",hide:!0},{fixed:"right",title:"操作",toolbar:"#scmManaOutsourceA_tabbar",width:160}]],done:function(e,t,i){var l=e.data;r=l}})}function i(){table.render({elem:"#scmManaOutSCA_tabStencil",url:setter.baseUrl+"scm/stencilorder/outsourcingContractAll/list",cellMinWidth:80,id:"scmManaOutSCA_tabStencil",page:!0,parseData:function(e){return{code:0,data:e.page.list,count:e.page.totalCount}},cols:[[{type:"checkbox",fixed:"left"},{field:"productNo",title:"聚谷型号",width:135,sort:!0},{field:"supplierNo",title:"供应商编号",width:124,sort:!0},{field:"status",title:"状态",templet:"#og_statusSA",minWidth:104,sort:!0},{field:"gmtCreate",title:"创建时间",width:166,sort:!0},{field:"pcbName",title:"聚谷物料号",width:144,sort:!0},{field:"quantityPcs",title:"订单数量(PCS)",width:134,sort:!0},{field:"unitPrice",title:"单价",width:96,sort:!0},{field:"engineeringFee",title:"工程费",width:96,sort:!0},{field:"testCostFee",title:"飞针费",width:96,sort:!0},{field:"testCostFee",title:"测试架费",width:96,sort:!0},{field:"toolingFee",title:"模具",width:96,sort:!0},{field:"totalFee",title:"合计",width:96,sort:!0},{field:"remark",title:"订单备注",width:168,sort:!0},{field:"supplierContractNo",title:"合同编号",minWidth:171,sort:!0},{field:"factoryMake",title:"供应商厂编",minWidth:190,sort:!0},{field:"dimensionsX",title:"dimensionsX",hide:!0},{field:"dimensionsY",title:"dimensionsY",hide:!0},{field:"panelSizeX",title:"panelSizeX",hide:!0},{field:"panelSizeY",title:"panelSizeY",hide:!0},{field:"panelWayX",title:"panelWayX",hide:!0},{field:"panelWayY",title:"panelWayY",hide:!0},{field:"unitPriceCustomer",title:"unitPriceCustomer",hide:!0},{field:"engineeringFeeCustomer",title:"engineeringFeeCustomer",hide:!0},{field:"testCostFeeCustomer",title:"testCostFeeCustomer",hide:!0},{field:"toolingFeeCustomer",title:"toolingFeeCustomer",hide:!0},{field:"subtotal",title:"subtotal",hide:!0},{fixed:"right",title:"操作",toolbar:"#scmManaOutsourceA_tabbarS",width:160}]],done:function(e,t,i){var l=e.data;stenciltabObj=l}})}table=layui.table,view=layui.view,admin=layui.admin,form=layui.form,setter=layui.setter,formSelects=layui.formSelects,element=layui.element;var l=layui.jquery,a=layui.convertCurrency,o=layui.requestInterface,n={orderType:0};t();var r;element.on("tab(tab-scmManagement)",function(e){n.orderType=e.index,1===e.index?(l(".outsourcing-contract-all-search").attr("reload-table","scmManaOutSCA_tabStencil"),i()):2===e.index?l(".outsourcing-contract-all-search").attr("reload-table",""):(l(".outsourcing-contract-all-search").attr("reload-table","scmManaOutSCA_tabPcb"),t())}),table.on("tool(scmManaOutSCA_tabPcb)",function(e){var t=e.data,i=t.supplierContractNo;if("eevScmedit"==e.event)layer.msg("编辑操作"),admin.popup({title:"PCB报价协同编辑",area:["50%","80%"],btn:["保存","下载客户资料","取消"],yes:function(e,t){layer.msg("提交信息"),form.val("scm-quote-detail-form-list",{optionMark:"save"}),l("#scm-quote-detail-form-submit").click()},btn2:function(e,t){return layer.msg("下载资料"),!1},success:function(e,i){view(this.id).render("scmManagement/iframeWindow/quote_detail_pcb",t).done(function(){form.render(null,"scm-quote-detail-form-list"),form.on("submit(LAY-scm-quote-detail-form-submit)",function(e){var t=e.field;if("pricing"===t.optionMark){var l=(parseFloat(t.engineeringFee)+parseFloat(t.overworkFee)+parseFloat(t.testCostFee)+parseFloat(t.toolingFee)+parseFloat(t.otherFee)+parseFloat(t.unitPrice*t.quantityPcs)).toFixed(2),a=(parseFloat(t.pcbaToolFee)+parseFloat(t.pcbaTestFee)+parseFloat(t.pcbaPartsFee)+parseFloat(t.pcbaProcessFee)).toFixed(2),o=(parseFloat(l)+parseFloat(a)).toFixed(2);return form.val("scm-quote-detail-form-list",{allFee:o,totalFee:l,pcbaSubtotalFee:a}),!1}"save"===t.optionMark&&(admin.req({type:"post",data:t,url:setter.baseUrl+"scm/pcborder/updateQuoteBeOt",done:function(e){layer.msg("供应商报价修改成功"),table.reload("scmManaOutSCA_tabPcb")},fail:function(e){layer.msg("供应商报价修改失败")}}),layer.close(i))})})}});else if("search"==e.event){for(var n,s={data:{}},d=e.data,i=d.supplierContractNo,c=0,u=0,f=0;f<r.length;f++)if(i==r[f].supplierContractNo){c+=1;var m=r[f];s.data[c]=m,u+=r[f].totalFee}for(var f=0;f<s.data.length;f++){var p=s.data[f].subtotal;u+=p,console.log("totalFee:"+u),console.log("sd_len:"+c)}n=a.conversion(u),console.log("convertSubtotal:"+n),s.totalFee=u,s.convertSubtotal=n,s.supplierInfo=o.GetSupplierInfo(setter.baseUrl+"sys/supplier/info/"+t.supplierId),console.log(s),admin.popup({title:"外协合同",area:["100%","100%"],btn:["打印","关闭"],yes:function(){var e="outsContract";document.body.innerHTML=document.getElementById(e).innerHTML,window.print(),window.location.reload()},success:function(){view(this.id).render("scmManagement/iframeWindow/outs_contract",s).done(function(){})}})}}),table.on("tool(scmManaOutSCA_tabStencil)",function(e){var t=e.data,i=t.supplierContractNo;if("eevScmedit"==e.event)layer.msg("编辑操作"),admin.popup({title:"Stencil 钢网报价协同编辑",area:["50%","80%"],btn:["保存","下载客户资料","取消"],yes:function(e,i){layer.msg("提交信息");var a=new Object;a.id=t.id,a.orderId=t.orderId,a.supplierId=t.supplierId,a.supplierQuoteNo=t.supplierQuoteNo,a.deliveryTime=l("#stencilDeliveryDate").val(),a.unitPrice=l("#qt_stencil_unitPrice").val(),a.remark=l("#sRemark").val(),a.status="",a.factoryMake=l("#stencilfactoryMake").val(),a.totalFee=l("#qt_stencil_totalFee").text(),console.log(a),admin.req({type:"post",data:a,url:setter.baseUrl+"scm/stencilorder/updateQuoteBeOt",success:function(t){layer.alert("供应商报价修改成功"),table.reload("scmMana_tabStencil"),layer.close(e)}})},btn2:function(e,t){return layer.msg("下载资料"),!1},success:function(e,i){view(this.id).render("scmManagement/iframeWindow/quote_detail_stencil",t).done(function(){})}});else if("search"==e.event){for(var n,r={data:{}},s=e.data,i=s.supplierContractNo,d=0,c=0,u=0;u<stenciltabObj.length;u++)if(i==stenciltabObj[u].supplierContractNo){d+=1;var f=stenciltabObj[u];r.data[d]=f,c+=stenciltabObj[u].totalStencilFee}for(var u=0;u<r.data.length;u++){console.log("开始循环");var m=r.data[u].totalStencilFee;c+=m,console.log("subtotal:"+c),console.log("sd_len:"+d)}n=a.conversion(c),console.log("convertSubtotal:"+n),r.subtotal=c,r.convertSubtotal=n,r.supplierInfo=o.GetSupplierInfo(setter.baseUrl+"sys/supplier/info/"+t.supplierId),admin.popup({title:"外协合同",area:["100%","100%"],btn:["打印","关闭"],yes:function(){var e="outsContract";document.body.innerHTML=document.getElementById(e).innerHTML,window.print(),window.location.reload()},success:function(){view(this.id).render("scmManagement/iframeWindow/outs_contractS",r).done(function(){})}})}}),form.on("submit(outsourcing_contract_all_search)",function(e){var t,i=e.field;0===n.orderType?t="scmManaOutSCA_tabPcb":1===n.orderType&&(t="scmManaOutSCA_tabStencil"),table.reload(t,{where:i})}),l(".outsourcing-contract-all-search input").bind("input propertychange",function(e){l("*[lay-filter='outsourcing_contract_all_search']").click()}),layui.formSelects.on("status",function(e,t,i,a,o){formSelects.value("status",[i.value]),l("*[lay-filter='outsourcing_contract_all_search']").click()}),e("scmManaA_outContract",{})});