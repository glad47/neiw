/** layuiAdmin.pro-v1.0.0 LPPL License By http://www.layui.com/admin/ */
 ;"use strict";layui.define(function(e){var t=layui.jquery,a=(new Object,{uploadcommon:function(e,a,r,n,o,d){function l(){function l(e){a.width(e+"%"),a.find("a").text(e+"%")}function i(e){if(e.lengthComputable){var t=Math.round(e.loaded/e.total*100);l(t);var a=(new Date).getTime(),n=(a-g)/1e3;g=(new Date).getTime();var o=e.loaded-b;b=e.loaded;var d=o/n,i=d,s="bit/s";d/1024>1&&(d/=1024,s="Kb/s"),d/1024>1&&(d/=1024,s="Mb/s"),d=d.toFixed(1);var u=((e.total-e.loaded)/i).toFixed(1);r.html(d+s+"，For the rest of："+u+"s")}}function s(e){n.attr("disabled",!1);var a=e.currentTarget.status;if(401==a)return void alert("请登录后再上传");if(403==a)return void alert("无权限操作");if(200!=a)return void alert("上传异常，错误码"+a);var r=JSON.parse(e.currentTarget.response),o=r.url,l=/\[(.+?)\]/g,i=o.match(l),s=i[0].replace(/\[|]/g,"");return"0"==r.code&&null!=d&&"undefined"!=typeof d&&(d.data.gerberName=d.data.quoteGerberName,d.data.gerberPath=d.data.gerberPath=s,m=d.data,0===d.type?(delete d.data.quoteGerberName,delete d.data.quoteGerberPath,m.isAddFile=!0):1===d.type&&(delete d.data.gerberName,delete d.data.gerberPath),localStorage.setItem("saveBackResult",JSON.stringify(m)),t.ajax({type:"post",url:d.url,data:d.data,success:function(e){setTimeout(function(){layer.msg("文件上传成功"),t(d.removeDom).css("display","none"),t(d.ffile).css({display:"",color:"green"}),"undefined"!=typeof d.data.quoteGerberName?t(d.ffile).text(d.data.quoteGerberName):t(d.ffile).text(d.data.gerberName),table.reload(d.retab)},1e3)}}),console.log(e.currentTarget.response),console.log(d)),console.log("上传成功"),m}function u(e){alert("上传处理失败"+e.target.responseText)}function c(){p.abort()}function f(e){alert("文件上传已终止:"+e.target.responseText)}var g=null,b=null,p=new XMLHttpRequest,m={},v={};console.log(a),o.click(function(){n.attr("disabled",!1),c()}),this.uploadFile=function(t){return n.attr("disabled",!0),l(0),p.open("post",e,!0),p.onloadstart=function(){console.log("开始上传"),g=(new Date).getTime(),b=0},p.upload.addEventListener("progress",i,!1),p.addEventListener("load",s,!1),p.addEventListener("error",u,!1),p.addEventListener("abort",f,!1),p.send(t),p},this.setProgressValue=function(e){a.width(e+"%"),a.find("a").text(e+"%")},this.getSaveBackData=function(){return v.aa="fuck",v}}return new l}});e("uploadCommon",a)});