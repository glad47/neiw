<title>评审订单添加</title>
<div class="layui-fluid">
    <script type="text/html" template lay-done="layui.data.done(d);">
        <form class="layui-form" lay-filter="pert_form">
            <div class="layui-form-item">
                <label class="layui-form-label">客户编号</label>
                <div class="layui-input-inline">
                    <select name="customerNo">
                        <option>选择客户</option>
                    </select>
                </div>
                <label class="layui-form-label">产品型号</label>
                <div class="layui-input-inline">
                    <input class="layui-input" type="text" name="productNo" id="pertUpload" placeholder="点击上传资料" readonly title="上传需要一定的时间，请耐心等待" style="cursor: pointer;">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">板费</label>
                <div class="layui-input-inline">
                    <input class="layui-input" type="text" name="boardFee">
                </div>
                <label class="layui-form-label">运费</label>
                <div class="layui-input-inline">
                    <input class="layui-input" type="text" name="postFee">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">测试费</label>
                <div class="layui-input-inline">
                    <input class="layui-input" type="text" name="testCostFee">
                </div>
                <label class="layui-form-label">工程费</label>
                <div class="layui-input-inline">
                    <input class="layui-input" type="text" name="engineeringFee">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">cnc磨具费</label>
                <div class="layui-input-inline">
                    <input class="layui-input" type="text" name="toolingFee">
                </div>
                <label class="layui-form-label">加急费</label>
                <div class="layui-input-inline">
                    <input class="layui-input" type="text" name="overworkFee">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">文件名</label>
                <div class="layui-input-inline">
                    <input class="layui-input" type="text" name="quoteGerberName">
                </div>
                <label class="layui-form-label">文件路径</label>
                <div class="layui-input-inline">
                    <input class="layui-input" type="text" name="quoteGerberPath">
                </div>
            </div>
            <div class="layui-form-item">
                <button type="button" lay-submit lay-filter="pertSysAddSubmit">提交</button>
            </div>
        </form>
    </script>
</div>

<script>
    layui.data.done = function (d) {
        layui.use(['setter', 'upload', 'admin', 'index', 'element', 'jquery', 'form', 'filePathProcess'], function () {
            var $ = layui.$,
                table = layui.table,
                form = layui.form,
                admin = layui.admin,
                view = layui.view
            var upload = layui.upload;
            var filepathprocess = layui.filePathProcess;
            admin.req({
                type: 'post',
                url: setter.baseUrl+'sys/consumer/user/all',
                success: function (data) {
                    console.log(data);
                    for (var i=0;i<data.data.length;i++){
                        $("select[name='customerNo']").append("<option id="+data.data[i].id+" value="+data.data[i].id+">"+data.data[i].userSystemId+"</option>");
                    }
                    form.render('select');
                }
            })
            form.render(null, "pert_form");
            //执行实例
            var uploadInst = upload.render({
                elem: '#pertUpload' //绑定元素
                ,url: setter.baseUrl+'sys/oss/upload/geber?access_token='+layui.data('layuiAdmin').access_token
                ,field: 'file'  //文件上传的字段名
                ,accept: 'file'
                ,exts: 'zip|rar|7z'
                ,before: function (obj) {
                    obj.preview(function (index, file, result) {
                        $("input[name='productNo']").val(file.name);   // 回填到表单=>文件名
                    });
                }
                ,done: function(res){
                    //上传完毕回调
                    $("input[name='quoteGerberPath']").val(filepathprocess.pathProcess(res.url));   // 回填到表单=>文件路径
                }
                ,error: function(){
                    //请求异常回调
                }
            });

            //  监听表单提交
            form.on('submit(pertSysAddSubmit)', function (data) {
                console.log(data.field);
                return false;
            });
        });
    }
</script>