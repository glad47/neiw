
<title>角色管理</title>
<div class="layui-fluid">
    <div class="layui-card" lay-filter="addInfo">
        <div class="layui-card-body">
        	<div class="layui-form-item">
	            <div class="layui-inline">
	                <label class="layui-form-label">角色名</label>
	                <div class="layui-input-inline">
	                    <input type="text" name="id" autocomplete="off" class="layui-input">
	                </div>
	            </div>
	            <div class="layui-inline">
	                <button class="layui-btn layuiadmin-btn-list" lay-submit lay-filter="LAY-app-contlist-search">
	                    <i class="layui-icon layui-icon-search layuiadmin-button-btn"></i>
	                </button>
	            </div>
	            <div class="layui-btn-group test-table-operate-btn" style="margin-bottom: 10px;">
	                <button class="layui-btn" id="customerInfo_add" data-type="role_add">新增</button>
	                <button class="layui-btn" data-type="getCheckLength">批量删除</button>
	            </div>
	        </div>
            
            <table class="layui-hide" id="role_listTab"></table>

            <script type="text/html" id="role-table-operate-barDemo">
              <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a>
              <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
              <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
            </script>
        </div>
    </div>

</div>

<script>
	layui.use(['admin', 'table'], function(){
    var table = layui.table
    ,admin = layui.admin
    ,setter = layui.setter
    ,view = layui.view
    ,form = layui.form;
  
    table.render({
      elem: '#role_listTab'
      ,url: setter.baseUrl+'sys/role/list'
      ,where: {
    		access_token: layui.data('layuiAdmin').access_token
  	    }
      ,width: admin.screen() > 1 ? 1500 : ''
      ,cols: [[
        {type:'checkbox', fixed: 'left',width:50}
        ,{field:'roleId', width:150, title: 'ID', fixed: 'left'}
        ,{field:'roleName', width:280, title: '角色名称'}
        ,{field:'remark', width:422, title: '备注'}
        ,{field:'createTime', width:200, title: '创建时间'}
        ,{width:390, align:'center', fixed: 'right', toolbar: '#role-table-operate-barDemo',title:'操作'}
      ]]
      ,page: true
    });
    
    //监听表格复选框选择
    // table.on('checkbox(test-table-operate)', function(obj){
    //   console.log(obj)
    // });
    // //监听工具条
    // table.on('tool(test-table-operate)', function(obj){
    //   var data = obj.data;
    //   if(obj.event === 'detail'){
    //     layer.msg('ID：'+ data.id + ' 的查看操作');
    //   } else if(obj.event === 'del'){
    //     layer.confirm('真的删除行么', function(index){
    //       obj.del();
    //       layer.close(index);
    //     });
    //   } else if(obj.event === 'edit'){
    //     layer.alert('编辑行：<br>'+ JSON.stringify(data))
    //   }
    // });
    
    // var $ = layui.$, active = {
    //   getCheckData: function(){ //获取选中数据
    //     var checkStatus = table.checkStatus('test-table-operate')
    //     ,data = checkStatus.data;
    //     layer.alert(JSON.stringify(data));
    //   }
    //   ,getCheckLength: function(){ //获取选中数目
    //     var checkStatus = table.checkStatus('test-table-operate')
    //     ,data = checkStatus.data;
    //     layer.msg('选中了：'+ data.length + ' 个');
    //   }
    //   ,isAll: function(){ //验证是否全选
    //     var checkStatus = table.checkStatus('test-table-operate');
    //     layer.msg(checkStatus.isAll ? '全选': '未全选')
    //   }
    // };

    var $ = layui.$, active = {
    	role_add: function(othis){
    		admin.popup({
    			title:'添加角色',
    			area: ['550px', '550px'],
    			id:'LAY-popup-role-add',
    			success:function(layero,index){
    				view(this.id).render('infoManagement/roleform').done(function(){
    					//清空form表单
    					//form.render(null,;'layuiadmin-app-form-list');

    					//监听提交
    					form.on('submit(layuiadmin-app-form-submit)',function(data){
    						var field = data.field;
    						admin.req({
    							url: setter.baseUrl+'sys/role/save',
    							type:'POST',
    							dataType:'json',
    							contentType:'application/json',
    							data: JSON.stringify(field),
    							success:function(data){
    								console.log(data);
    								layui.table.reload('role_listTab'); //重载表格
               						layer.close(index); //执行关闭 
    							}
    						})

    					});
    				});
    			}
    		});
    	}
    }
    
    $('.test-table-operate-btn .layui-btn').on('click', function(){
      var type = $(this).data('type');
      active[type] ? active[type].call(this) : '';
    });
  
  });
</script>